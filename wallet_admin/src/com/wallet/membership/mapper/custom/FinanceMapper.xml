<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.wallet.membership.mapper.custom.FinanceMapper" >
	<resultMap id="BaseResultMap" type="com.wallet.membership.model.custom.Finance" >
	<!--
	WARNING - @mbggenerated
	This element is automatically generated by MyBatis Generator, do not modify.
	This element was generated on Tue Aug 14 13:40:21 KST 2012.
	-->
		<result column="BANK_ID" property="bankId" jdbcType="VARCHAR"/> 
		<result column="NAME" property="name" jdbcType="VARCHAR"/> 
		<result column="SVC_1" property="svc1" jdbcType="VARCHAR"/> 
		<result column="SVC_2" property="svc2" jdbcType="VARCHAR"/> 
		<result column="SVC_3" property="svc3" jdbcType="VARCHAR"/> 
		<result column="SVC_4" property="svc4" jdbcType="VARCHAR"/> 
		<result column="ALLY_STAT" property="allyStat" jdbcType="VARCHAR"/> 
		<result column="BUSINESS_NO" property="businessNo" jdbcType="VARCHAR"/> 
		<result column="ZIPCODE" property="zipcode" jdbcType="VARCHAR"/> 
		<result column="ADDR" property="addr" jdbcType="VARCHAR"/> 
		<result column="ADDR_DETAIL" property="addrDetail" jdbcType="VARCHAR"/> 
		<result column="MAIN_NUMBER" property="mainNumber" jdbcType="VARCHAR"/> 
		<result column="MANAGER_NAME" property="managerName" jdbcType="VARCHAR"/> 
		<result column="PHONE_NO" property="phoneNo" jdbcType="VARCHAR"/> 
		<result column="MOBILE_PHONE" property="mobilePhone" jdbcType="VARCHAR"/> 
		<result column="EMAIL" property="email" jdbcType="VARCHAR"/> 
		<result column="DC_METHOD_INFO" property="dcMethodInfo" jdbcType="VARCHAR"/> 
		<result column="MEMO" property="memo" jdbcType="VARCHAR"/> 
		<result column="REG_USER" property="regUser" jdbcType="VARCHAR" />
		<result column="REG_USER_NM" property="regUserNm" jdbcType="VARCHAR" />
		<result column="REG_DTM" property="regDtm" jdbcType="VARCHAR" />
		<result column="CHG_USER" property="chgUser" jdbcType="VARCHAR" />
		<result column="CHG_USER_NM" property="chgUserNm" jdbcType="VARCHAR" />
		<result column="CHG_DTM" property="chgDtm" jdbcType="VARCHAR" />
	</resultMap>

	<!-- 조회조건에 대한 금융사 목록 -->
	<select id="selectFinanceList" parameterType="HashMap" resultMap="BaseResultMap" >
		SELECT *
		FROM (
			SELECT <if test='top != null and top != ""'> top ${top} </if>
				ROW_NUMBER() OVER(ORDER BY S.REG_DTM DESC) AS IDX 
				, S.BANK_ID
				, S.NAME
				, S.SVC_1
				, S.SVC_2
				, S.SVC_3
				, S.SVC_4
				, S.ALLY_STAT
				, S.BUSINESS_NO
				, S.ZIPCODE
				, S.ADDR
				, S.ADDR_DETAIL
				, S.MAIN_NUMBER
				, S.MANAGER_NAME
				, S.PHONE_NO
				, S.MOBILE_PHONE
				, S.EMAIL
				, S.DC_METHOD_INFO
				, S.MEMO
				, S.REG_USER
				/*, U1.AUTH_NAME AS REG_USER_NM*/
				, CONVERT(VARCHAR(10), S.REG_DTM, 120) as REG_DTM
				, S.CHG_USER
				/*, U2.AUTH_NAME AS CHG_USER_NM*/
				, CONVERT(VARCHAR(10), S.CHG_DTM, 120) as CHG_DTM
			FROM CPN_BANK_INFO S/*, USER_DESC U1, USER_DESC U2*/
			WHERE 1=1
			/*
			AND U1.USER_ID = S.REG_USER
			AND U2.USER_ID = S.CHG_USER
			*/
			<if test='bankId != null and bankId != ""'>
				AND S.BANK_ID = #{bankId}
			</if>
			<if test='ra_searchTerm != null and ra_searchTerm != "" and ra_searchTerm != "all"'>
				<if test='sdate != null and sdate != ""'>
					<if test='se_termOpt == "reg_date"'>
						<![CDATA[
							AND CONVERT(VARCHAR(10), S.REG_DTM, 120) >=	#{sdate}
						]]>
					</if>
					<if test='se_termOpt == "chg_date"'>
						<![CDATA[
							AND CONVERT(VARCHAR(10), S.CHG_DTM, 120) >=	#{sdate}
						]]>
					</if>
				</if>
				<if test='edate != null and edate != ""'>
					<if test='se_termOpt == "reg_date"'>
						<![CDATA[
							AND CONVERT(VARCHAR(10), S.REG_DTM, 120) <=	#{edate}
						]]>
					</if>
					<if test='se_termOpt == "chg_date"'>
						<![CDATA[
							AND CONVERT(VARCHAR(10), S.CHG_DTM, 120) <=	#{edate}
						]]>
					</if>
				</if>
			</if>
			<if test='se_termOpt == "chg_date"'>
				AND S.CHG_DTM IS NOT NULL
			</if>
			<if test='seBankName != null and seBankName != ""'>
				AND S.NAME LIKE '%${seBankName}%'
			</if>
			<if test='ra_allyStat != null and ra_allyStat != "" and ra_allyStat != "all"'>
				AND S.ALLY_STAT = #{ra_allyStat}
			</if>
			) A
		WHERE 1=1
		<if test='startRow != null and startRow != ""'>
			<if test='rowsPerPage != null and rowsPerPage != ""'>
 				AND A.IDX BETWEEN #{startRow, jdbcType=INTEGER} AND #{endRow, jdbcType=INTEGER}
			</if>
		</if>
	</select>
	
	<!-- 조회조건에 대한 금융사 총 수 -->
	<select id="selectFinanceListCnt" parameterType="HashMap" resultType="java.lang.Integer">
		SELECT COUNT(*) AS CNT
		FROM CPN_BANK_INFO S
		WHERE 1=1
		<if test='bankId != null and bankId != ""'>
			AND S.BANK_ID = #{bankId}
		</if>
		<if test='ra_searchTerm != null and ra_searchTerm != "" and ra_searchTerm != "all"'>
			<if test='sdate != null and sdate != ""'>
				<if test='se_termOpt == "reg_date"'>
					<![CDATA[
						AND CONVERT(VARCHAR(10), S.REG_DTM, 120) >=	#{sdate}
					]]>
				</if>
				<if test='se_termOpt == "chg_date"'>
					<![CDATA[
						AND CONVERT(VARCHAR(10), S.CHG_DTM, 120) >=	#{sdate}
					]]>
				</if>
			</if>
				
			<if test='edate != null and edate != ""'>
				<if test='se_termOpt == "reg_date"'>
					<![CDATA[
						AND CONVERT(VARCHAR(10), S.REG_DTM, 120) <=	#{edate}
					]]>
				</if>
				<if test='se_termOpt == "chg_date"'>
					<![CDATA[
						AND CONVERT(VARCHAR(10), S.CHG_DTM, 120) <=	#{edate}
					]]>
				</if>
			</if>
		</if>
		<if test='se_termOpt == "chg_date"'>
			AND S.CHG_DTM IS NOT NULL
		</if>
		<if test='seBankName != null and seBankName != ""'>
			AND S.NAME LIKE '%${seBankName}%'
		</if>
		<if test='ra_allyStat != null and ra_allyStat != "" and ra_allyStat != "all"'>
			AND S.ALLY_STAT = #{ra_allyStat}
		</if>
	</select>
	
	<!-- 조회조건에 대한 금융사 목록 -->
	<select id="selectFinanceInfo" parameterType="HashMap" resultMap="BaseResultMap" >
		SELECT  S.BANK_ID
				, S.NAME
				, S.SVC_1
				, S.SVC_2
				, S.SVC_3
				, S.SVC_4
				, S.ALLY_STAT
				, S.BUSINESS_NO
				, S.ZIPCODE
				, S.ADDR
				, S.ADDR_DETAIL
				, S.MAIN_NUMBER
				, S.MANAGER_NAME
				, S.PHONE_NO
				, S.MOBILE_PHONE
				, S.EMAIL
				, S.DC_METHOD_INFO
				, S.MEMO
				, S.REG_USER
				/*, U1.AUTH_NAME AS REG_USER_NM*/
				, CONVERT(VARCHAR(10), S.REG_DTM, 120) as REG_DTM
				, S.CHG_USER
				/*, U2.AUTH_NAME AS CHG_USER_NM*/
				, CONVERT(VARCHAR(10), S.CHG_DTM, 120) as CHG_DTM
		FROM CPN_BANK_INFO S
		WHERE S.BANK_ID = #{bankId}
	</select>

	<insert id="insertFinance" parameterType="HashMap">
		INSERT INTO CPN_BANK_INFO
		<trim prefix="(" suffix=")" suffixOverrides="," >
				BANK_ID,
			<if test='name != null and name != ""' >NAME,</if>
			<if test='svc1 != null and svc1 != ""' >SVC_1,</if>
			<if test='svc2 != null and svc2 != ""' >SVC_2,</if>
			<if test='svc3 != null and svc3 != ""' >SVC_3,</if>
			<if test='svc4 != null and svc4 != ""' >SVC_4,</if>
			<if test='allyStat != null and allyStat != ""' >ALLY_STAT,</if>
			<if test='businessNo != null and businessNo != ""' >BUSINESS_NO,</if>
			<if test='zipcode != null and zipcode != ""' >ZIPCODE,</if>
			<if test='addr != null and addr != ""' >ADDR,</if>
			<if test='addrDetail != null and addrDetail != ""' >ADDR_DETAIL,</if>
			<if test='mainNumber != null and mainNumber != ""' >MAIN_NUMBER,</if>
			<if test='managerName != null and managerName != ""' >MANAGER_NAME,</if>
			<if test='phoneNo != null and phoneNo != ""' >PHONE_NO,</if>
			<if test='mobilePhone != null and mobilePhone != ""' >MOBILE_PHONE,</if>
			<if test='email != null and email != ""' >EMAIL,</if>
				REG_USER,
				REG_DTM,
			<if test='dcMethodInfo != null and dcMethodInfo != ""' >DC_METHOD_INFO,</if>
			<if test='memo != null and memo != ""' >MEMO,</if>
		</trim>
		<trim prefix="" suffix="" suffixOverrides="," >
			SELECT LTRIM(STR((ISNULL(RIGHT(MAX(BANK_ID),3),0)+1))) ,
			<if test='name != null and name != ""' >#{name},</if>
			<if test='svc1 != null and svc1 != ""' >#{svc1},</if>
			<if test='svc2 != null and svc2 != ""' >#{svc2},</if>
			<if test='svc3 != null and svc3 != ""' >#{svc3},</if>
			<if test='svc4 != null and svc4 != ""' >#{svc4},</if>
			<if test='allyStat != null and allyStat != ""' >#{allyStat},</if>
			<if test='businessNo != null and businessNo != ""' >#{businessNo},</if>
			<if test='zipcode != null and zipcode != ""' >#{zipcode},</if>
			<if test='addr != null and addr != ""' >#{addr},</if>
			<if test='addrDetail != null and addrDetail != ""' >#{addrDetail},</if>
			<if test='mainNumber != null and mainNumber != ""' >#{mainNumber},</if>
			<if test='managerName != null and managerName != ""' >#{managerName},</if>
			<if test='phoneNo != null and phoneNo != ""' >#{phoneNo},</if>
			<if test='mobilePhone != null and mobilePhone != ""' >#{mobilePhone},</if>
			<if test='email != null and email != ""' >#{email},</if>
				#{regUser},
				GETDATE(),
			<if test='dcMethodInfo != null and dcMethodInfo != ""' >#{dcMethodInfo},</if>
			<if test='memo != null and memo != ""' >#{memo},</if>
		</trim>
			FROM CPN_BANK_INFO
	</insert>

	<update id="updateFinance" parameterType="HashMap">
		UPDATE CPN_BANK_INFO
		<set >
		<trim prefix="" suffix="" suffixOverrides="," >
			<if test='name != null'> NAME = #{name},</if>
			<if test='svc1 != null'> SVC_1 = #{svc1},</if>
			<if test='svc2 != null'> SVC_2 = #{svc2},</if>
			<if test='svc3 != null'> SVC_3 = #{svc3},</if>
			<if test='svc4 != null'> SVC_4 = #{svc4},</if>
			<if test='allyStat != null' >  ALLY_STAT = #{allyStat},</if>
			<if test='businessNo != null and businessNo != ""' > BUSINESS_NO = #{businessNo},</if>
			<if test='businessNo == null or businessNo == ""' > BUSINESS_NO = '',</if>
			<if test='zipcode != null' >ZIPCODE = #{zipcode},</if>
			<if test='addr != null' > ADDR = #{addr},</if>
			<if test='addrDetail != null' > ADDR_DETAIL = #{addrDetail},</if>
			<if test='mainNumber != null' > MAIN_NUMBER = #{mainNumber},</if>
			<if test='managerName != null' > MANAGER_NAME = #{managerName},</if>
			<if test='phoneNo != null' > PHONE_NO = #{phoneNo},</if>
			<if test='mobilePhone != null and mobilePhone !=""' > MOBILE_PHONE = #{mobilePhone},</if>
			<if test='mobilePhone == null or mobilePhone ==""' > MOBILE_PHONE = '',</if>
			<if test='email != null' > EMAIL = #{email},</if>
			
				CHG_USER = #{chgUser},
				CHG_DTM = GETDATE(),
				
			<if test='dcMethodInfo != null' > DC_METHOD_INFO = #{dcMethodInfo},</if>
			<if test='memo != null and memo != ""' > MEMO = #{memo},</if>
			<if test='memo == null or memo == ""' > MEMO = '',</if>
		</trim>
		</set>
		WHERE BANK_ID = #{bankId}
	</update>
	
	<delete id="deleteFinance" parameterType="HashMap">
		DELETE
		FROM CPN_BANK_INFO
		WHERE BANK_ID = #{bankId} 
	</delete>
</mapper>