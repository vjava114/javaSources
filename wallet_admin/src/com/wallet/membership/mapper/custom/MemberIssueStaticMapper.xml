<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.wallet.membership.mapper.custom.MemberIssueStaticMapper" >
	<resultMap id="BaseResultMap" type="com.wallet.membership.model.custom.MemberIssueStatic" >
	<!--
	WARNING - @mbggenerated
	This element is automatically generated by MyBatis Generator, do not modify.
	This element was generated on Tue Aug 14 13:40:21 KST 2012.
	-->
		<result column="IDX" property="idx" jdbcType="VARCHAR" />
		<result column="MEMB_ID" property="membId" jdbcType="VARCHAR" />
		<result column="STAT_DAY" property="statDay" jdbcType="VARCHAR" />
		<result column="NAME" property="name" jdbcType="VARCHAR" />
		<result column="USER_CNT" property="userCnt" jdbcType="VARCHAR" />
		<result column="PRE_DAY_RATIO" property="preDayRatio" jdbcType="VARCHAR" />
		<result column="PRE_MONTH_RATIO" property="preMonthRatio" jdbcType="VARCHAR" />
		<result column="STAT_TYPE" property="statType" jdbcType="VARCHAR" />
		<result column="STAT_MONTH" property="statMonth" jdbcType="VARCHAR" />
	</resultMap>

	<!-- 조회조건에 대한 멤버십 목록 -->
	<select id="selectMemberIssueStaticDayList" parameterType="HashMap" resultMap="BaseResultMap" >
		SELECT SUBSTRING(STAT_DAY,0,5)+'-'+SUBSTRING(STAT_DAY,5,2)+'-'+SUBSTRING(STAT_DAY,7,2) as STAT_DAY
			, MEMB_ID
			, NAME
			, USER_CNT
			, PRE_DAY_RATIO
			, PRE_MONTH_RATIO
		FROM MW_MS_MEMB_DAY_STAT_ISSUE
		WHERE STAT_TYPE = '03' 
		<if test='ra_searchTerm!=null and ra_searchTerm!="" and ra_searchTerm!="all"'>
			<if test='sdate!=null and sdate!=""'>
				<if test='se_termOpt == "dayDate"'>
					<![CDATA[
						AND CONVERT(VARCHAR(8), STAT_DAY, 112) >=	REPLACE(#{sdate}, '-', '')
					]]>
				</if>
			</if>
			<if test='edate!=null and edate!=""'>
				<if test='se_termOpt == "dayDate"'>
					<![CDATA[
						AND CONVERT(VARCHAR(8), STAT_DAY, 112) <=	REPLACE(#{edate}, '-', '')
					]]>
				</if>
			</if>
		</if>
		<if test='name!=null and name!=""'>
			AND NAME LIKE '%${name}%'
		</if>
		ORDER BY STAT_DAY ASC
	</select>
	
	<resultMap type="hashMap" id="dataMap">
  	<result property="contents" column="contents" jdbcType="CLOB" javaType="java.lang.String" />
 	</resultMap>
 	
	<select id="selectMemberIssueStaticMonthList" parameterType="map" resultMap="dataMap" >
		SELECT
			  MEMB_ID
			, NAME
			${subQuery}
			/*
			, SUM(CASE WHEN STAT_MONTH = STAT_MONTH THEN ISNULL(USER_CNT,0) ELSE 0 END) AS USER_CNT1 
			, SUM(CASE WHEN STAT_MONTH = STAT_MONTH THEN ISNULL(PRE_MONTH_RATIO,0) ELSE 0 END) AS PRE_MONTH_RATIO1
			, SUM(CASE WHEN STAT_MONTH = SUBSTRING( REPLACE(CONVERT(VARCHAR(50),DATEADD(M,+1,CONVERT(datetime,STAT_MONTH+'01')),120),'-',''),1,6) THEN ISNULL(USER_CNT,0) ELSE 0 END) AS USER_CNT2
			, SUM(CASE WHEN STAT_MONTH = SUBSTRING( REPLACE(CONVERT(VARCHAR(50),DATEADD(M,+1,CONVERT(datetime,STAT_MONTH+'01')),120),'-',''),1,6) THEN ISNULL(PRE_MONTH_RATIO,0) ELSE 0 END) AS PRE_MONTH_RATIO2 
			, SUM(CASE WHEN STAT_MONTH = SUBSTRING( REPLACE(CONVERT(VARCHAR(50),DATEADD(M,+2,CONVERT(datetime,STAT_MONTH+'01')),120),'-',''),1,6) THEN ISNULL(USER_CNT,0) ELSE 0 END) AS USER_CNT3
			, SUM(CASE WHEN STAT_MONTH = SUBSTRING( REPLACE(CONVERT(VARCHAR(50),DATEADD(M,+2,CONVERT(datetime,STAT_MONTH+'01')),120),'-',''),1,6) THEN ISNULL(PRE_MONTH_RATIO,0) ELSE 0 END) AS PRE_MONTH_RATIO3 
			, SUM(CASE WHEN STAT_MONTH = SUBSTRING( REPLACE(CONVERT(VARCHAR(50),DATEADD(M,+3,CONVERT(datetime,STAT_MONTH+'01')),120),'-',''),1,6) THEN ISNULL(USER_CNT,0) ELSE 0 END) AS USER_CNT4
			, SUM(CASE WHEN STAT_MONTH = SUBSTRING( REPLACE(CONVERT(VARCHAR(50),DATEADD(M,+3,CONVERT(datetime,STAT_MONTH+'01')),120),'-',''),1,6) THEN ISNULL(PRE_MONTH_RATIO,0) ELSE 0 END) AS PRE_MONTH_RATIO4 
			*/
		FROM MW_MS_MEMB_MONTH_STAT_ISSUE
		WHERE STAT_TYPE = '03'
		<!-- 
		<if test='ra_searchTerm!=null and ra_searchTerm!="" and ra_searchTerm!="all"'>
			<if test='sdate!=null and sdate!=""'>
				<if test='se_termOpt == "monthDate"'>
					<![CDATA[
						AND STAT_MONTH >= LEFT(REPLACE(#{sdate}, '-', ''), 6)
					]]>
				</if>
			</if>
			<if test='edate!=null and edate!=""'>
				<if test='se_termOpt == "monthDate"'>
					<![CDATA[
						AND STAT_MONTH <= LEFT(REPLACE(#{edate}, '-', ''), 6)
					]]>
				</if>
			</if>
		</if>
		-->
		<if test='name!=null and name!=""'>
			AND NAME LIKE '%${name}%'
		</if>
		GROUP BY
			 MEMB_ID
			, NAME
	</select>
	
	<select id="selectMemberIssueCancelStaticDayList" parameterType="HashMap" resultMap="BaseResultMap" >
		SELECT SUBSTRING(STAT_DAY,0,5)+'-'+SUBSTRING(STAT_DAY,5,2)+'-'+SUBSTRING(STAT_DAY,7,2) as STAT_DAY
			, MEMB_ID
			, NAME
			, USER_CNT
			, PRE_DAY_RATIO
			, PRE_MONTH_RATIO
		FROM MW_MS_MEMB_DAY_STAT_ISSUE
		WHERE STAT_TYPE = '04' 
		<if test='ra_searchTerm!=null and ra_searchTerm!="" and ra_searchTerm!="all"'>
				<if test='sdate!=null and sdate!=""'>
					<if test='se_termOpt == "dayDate"'>
						<![CDATA[
							AND CONVERT(VARCHAR(8), STAT_DAY, 112) >=	REPLACE(#{sdate}, '-', '')
						]]>
					</if>
					<if test='edate!=null and edate!=""'>
						<if test='se_termOpt == "dayDate"'>
							<![CDATA[
								AND CONVERT(VARCHAR(8), STAT_DAY, 112) <=	REPLACE(#{edate}, '-', '')
							]]>
						</if>
					</if>
				</if>
			</if>
		<if test='name!=null and name!=""'>
			AND NAME LIKE '%${name}%'
		</if>
		ORDER BY STAT_DAY ASC
	</select>
	
	<select id="selectMemberIssueCancelStaticMonthList" parameterType="map" resultMap="dataMap" >
		SELECT
			  MEMB_ID
			, NAME
			${subQuery}
			/*
			, SUM(CASE WHEN STAT_MONTH = STAT_MONTH THEN ISNULL(USER_CNT,0) ELSE 0 END) AS USER_CNT1 
			, SUM(CASE WHEN STAT_MONTH = STAT_MONTH THEN ISNULL(PRE_MONTH_RATIO,0) ELSE 0 END) AS PRE_MONTH_RATIO1
			, SUM(CASE WHEN STAT_MONTH = SUBSTRING( REPLACE(CONVERT(VARCHAR(50),DATEADD(M,+1,CONVERT(datetime,STAT_MONTH+'01')),120),'-',''),1,6) THEN ISNULL(USER_CNT,0) ELSE 0 END) AS USER_CNT2
			, SUM(CASE WHEN STAT_MONTH = SUBSTRING( REPLACE(CONVERT(VARCHAR(50),DATEADD(M,+1,CONVERT(datetime,STAT_MONTH+'01')),120),'-',''),1,6) THEN ISNULL(PRE_MONTH_RATIO,0) ELSE 0 END) AS PRE_MONTH_RATIO2 
			, SUM(CASE WHEN STAT_MONTH = SUBSTRING( REPLACE(CONVERT(VARCHAR(50),DATEADD(M,+2,CONVERT(datetime,STAT_MONTH+'01')),120),'-',''),1,6) THEN ISNULL(USER_CNT,0) ELSE 0 END) AS USER_CNT3
			, SUM(CASE WHEN STAT_MONTH = SUBSTRING( REPLACE(CONVERT(VARCHAR(50),DATEADD(M,+2,CONVERT(datetime,STAT_MONTH+'01')),120),'-',''),1,6) THEN ISNULL(PRE_MONTH_RATIO,0) ELSE 0 END) AS PRE_MONTH_RATIO3 
			, SUM(CASE WHEN STAT_MONTH = SUBSTRING( REPLACE(CONVERT(VARCHAR(50),DATEADD(M,+3,CONVERT(datetime,STAT_MONTH+'01')),120),'-',''),1,6) THEN ISNULL(USER_CNT,0) ELSE 0 END) AS USER_CNT4
			, SUM(CASE WHEN STAT_MONTH = SUBSTRING( REPLACE(CONVERT(VARCHAR(50),DATEADD(M,+3,CONVERT(datetime,STAT_MONTH+'01')),120),'-',''),1,6) THEN ISNULL(PRE_MONTH_RATIO,0) ELSE 0 END) AS PRE_MONTH_RATIO4 
			*/
		FROM MW_MS_MEMB_MONTH_STAT_ISSUE
		WHERE STAT_TYPE = '04'
		<if test='ra_searchTerm!=null and ra_searchTerm!="" and ra_searchTerm!="all"'>
			<if test='sdate!=null and sdate!=""'>
				<if test='se_termOpt == "monthDate"'>
					<![CDATA[
						AND STAT_MONTH >= LEFT(REPLACE(#{sdate}, '-', ''), 6)
					]]>
				</if>
			</if>
			<if test='edate!=null and edate!=""'>
				<if test='se_termOpt == "monthDate"'>
					<![CDATA[
						AND STAT_MONTH <= LEFT(REPLACE(#{edate}, '-', ''), 6)
					]]>
				</if>
			</if>
		</if>
		<if test='name!=null and name!=""'>
			AND NAME LIKE '%${name}%'
		</if>
		GROUP BY
			 MEMB_ID
			, NAME
	</select>


</mapper>