<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.wallet.membership.mapper.custom.MemberJoinStaticMapper" >
	<resultMap id="BaseResultMap" type="com.wallet.membership.model.custom.MemberJoinStatic" >
	<!--
	WARNING - @mbggenerated
	This element is automatically generated by MyBatis Generator, do not modify.
	This element was generated on Tue Aug 14 13:40:21 KST 2012.
	-->
		<result column="IDX" property="idx" jdbcType="VARCHAR" />
		<result column="MEMB_ID" property="membId" jdbcType="VARCHAR" />
		<result column="STAT_DAY" property="statDay" jdbcType="VARCHAR" />
		<result column="NAME" property="name" jdbcType="VARCHAR" />
		<result column="USER_CNT" property="userCnt" jdbcType="VARCHAR" />
		<result column="PRE_DAY_RATIO" property="preDayRatio" jdbcType="VARCHAR" />
		<result column="PRE_MONTH_RATIO" property="preMonthRatio" jdbcType="VARCHAR" />

		<!-- 단말기별 안드로이드 -->	
		<result column="ANDROID_KT_CNT" property="android_kt_cnt" jdbcType="VARCHAR" />
		<result column="ANDROID_SKT_CNT" property="android_skt_cnt" jdbcType="VARCHAR" />
		<result column="ANDROID_LGU_CNT" property="android_lgu_cnt" jdbcType="VARCHAR" />
		<result column="ANDROID_CNT" property="android_cnt" jdbcType="VARCHAR" />

		<!-- 단말기별 아이폰 -->	
		<result column="IPHONE_KT_CNT" property="ios_kt_cnt" jdbcType="VARCHAR" />
		<result column="IPHONE_SKT_CNT" property="ios_skt_cnt" jdbcType="VARCHAR" />
		<result column="IPHONE_LGU_CNT" property="ios_lgu_cnt" jdbcType="VARCHAR" />
		<result column="IPHONE_CNT" property="ios_cnt" jdbcType="VARCHAR" />
		<!-- 단말기별 총 합계 -->
		<result column="TOTAL_CNT" property="total_cnt" jdbcType="VARCHAR" />
		
		<!-- 연령/성별 통계 -->
		<result column="AGE00_M_CNT" property="age00_m_cnt" jdbcType="VARCHAR" />
		<result column="AGE00_F_CNT" property="age00_f_cnt" jdbcType="VARCHAR" />
		<result column="AGE10_M_CNT" property="age10_m_cnt" jdbcType="VARCHAR" />
		<result column="AGE10_F_CNT" property="age10_f_cnt" jdbcType="VARCHAR" />
		<result column="AGE20_M_CNT" property="age20_m_cnt" jdbcType="VARCHAR" />
		<result column="AGE20_F_CNT" property="age20_f_cnt" jdbcType="VARCHAR" />
		<result column="AGE30_M_CNT" property="age30_m_cnt" jdbcType="VARCHAR" />
		<result column="AGE30_F_CNT" property="age30_f_cnt" jdbcType="VARCHAR" />
		<result column="AGE40_M_CNT" property="age40_m_cnt" jdbcType="VARCHAR" />
		<result column="AGE40_F_CNT" property="age40_f_cnt" jdbcType="VARCHAR" />
		<result column="AGE50_M_CNT" property="age50_m_cnt" jdbcType="VARCHAR" />
		<result column="AGE50_F_CNT" property="age50_f_cnt" jdbcType="VARCHAR" />
		<result column="AGE60_M_CNT" property="age60_m_cnt" jdbcType="VARCHAR" />
		<result column="AGE60_F_CNT" property="age60_f_cnt" jdbcType="VARCHAR" />
		<result column="M_CNT" property="m_cnt" jdbcType="VARCHAR" />
		<result column="F_CNT" property="f_cnt" jdbcType="VARCHAR" />

		<!-- 일반 월별 통계 -->
		<result column="SUM_CNT" property="sum_cnt" jdbcType="VARCHAR" />
		

	</resultMap>
	

	<!-- 조회조건에 대한 멤버십 목록 (가입통계 - 단말기OS통신사 부분) -->
	<select id="selectMemberJoinStaticDayList" parameterType="HashMap" resultMap="BaseResultMap" >
		SELECT 
		  STAT_DAY
			, MEMB_ID
			, NAME
			, ANDROID_KT_CNT
			, ANDROID_SKT_CNT
			, ANDROID_LGU_CNT
			, (ANDROID_KT_CNT + ANDROID_SKT_CNT + ANDROID_LGU_CNT ) AS ANDROID_CNT
			, IPHONE_KT_CNT
			, IPHONE_SKT_CNT
			, IPHONE_LGU_CNT
			, (IPHONE_KT_CNT + IPHONE_SKT_CNT + IPHONE_LGU_CNT ) AS IPHONE_CNT
			, (ANDROID_KT_CNT + ANDROID_SKT_CNT + ANDROID_LGU_CNT + IPHONE_KT_CNT + IPHONE_SKT_CNT + IPHONE_LGU_CNT ) AS TOTAL_CNT
		FROM MW_MS_MEMB_DAY_STAT_OS_MO
		WHERE STAT_TYPE = '01'
		<if test='ra_searchTerm!=null and ra_searchTerm!="" and ra_searchTerm!="all"'>
				<if test='sdate!=null and sdate!=""'>
					<if test='se_termOpt == "dayDate"'>
						<![CDATA[
							AND CONVERT(VARCHAR(8), STAT_DAY, 112) >=	REPLACE(#{sdate}, '-', '')
						]]>
					</if>
					<if test='edate!=null and edate!=""'>
						<if test='se_termOpt == "dayDate"'>
							<![CDATA[
								AND CONVERT(VARCHAR(8), STAT_DAY, 112) <=	REPLACE(#{edate}, '-', '')
							]]>
						</if>
					</if>
				</if>
			</if>
		<if test='name!=null and name!=""'>
			AND NAME LIKE '%${name}%'
		</if>
	</select>

		<!-- 조회조건에 대한 멤버십 목록 가입통계 - 연령/성별 통계 -->
	<select id="selectMemberJoinAgeStaticDayList" parameterType="HashMap" resultMap="BaseResultMap" >
		SELECT 
		    STAT_DAY
			, MEMB_ID
			, NAME
			, AGE00_M_CNT
			, AGE00_F_CNT
			, AGE10_M_CNT
			, AGE10_F_CNT
			, AGE20_M_CNT
			, AGE20_F_CNT
			, AGE30_M_CNT
			, AGE30_F_CNT
			, AGE40_M_CNT
			, AGE40_F_CNT
			, AGE50_M_CNT
			, AGE50_F_CNT
			, AGE60_M_CNT
			, AGE60_F_CNT
			, ( AGE00_M_CNT + AGE10_M_CNT + AGE20_M_CNT + AGE30_M_CNT + AGE40_M_CNT + AGE50_M_CNT + AGE60_M_CNT ) AS M_CNT
			, ( AGE00_F_CNT + AGE10_F_CNT + AGE20_F_CNT + AGE30_F_CNT + AGE40_F_CNT + AGE50_F_CNT + AGE60_F_CNT ) AS F_CNT
		FROM MW_MS_MEMB_DAY_STAT_AGE_SEX
		WHERE STAT_TYPE = '01' 

		<if test='ra_searchTerm!=null and ra_searchTerm!="" and ra_searchTerm!="all"'>
				<if test='sdate!=null and sdate!=""'>
					<if test='se_termOpt == "dayDate"'>
						<![CDATA[
							AND CONVERT(VARCHAR(8), STAT_DAY, 112) >=	REPLACE(#{sdate}, '-', '')
						]]>
					</if>
					<if test='edate!=null and edate!=""'>
						<if test='se_termOpt == "dayDate"'>
							<![CDATA[
								AND CONVERT(VARCHAR(8), STAT_DAY, 112) <=	REPLACE(#{edate}, '-', '')
							]]>
						</if>
					</if>
				</if>
			</if>
		<if test='name!=null and name!=""'>
			AND NAME LIKE '%${name}%'
		</if>
	</select>
	
	<!-- 월별(다이나믹으로 돌아가는 아이들)은 parameterType을 map 으로 -->
	<resultMap type="hashMap" id="dataMap">
		<result property="contents" column="contents" jdbcType="CLOB" javaType="java.lang.String" />
	</resultMap>
	
	
	
		<select id="getMemberJoinMemberShips" parameterType="map" resultMap="dataMap">
			select MEMB_ID,NAME, COUNT(*) AS CNTS from MW_MS_MEMB_DAY_STAT WHERE STAT_TYPE = '01'
			<if test='name!=null and name!=""'>
				AND NAME LIKE '%${name}%'
			</if>
			<if test='membId!=null and membId!=""'>
				AND MEMB_ID = '${membId}'
			</if>
			GROUP BY MEMB_ID, NAME
		</select>


	<!-- 가입통계 일반통계 일별 -->
	<select id="selectMemberJoinNomalStaticDayList" parameterType="map" resultMap="dataMap">
		SELECT 
			  STAT_DAY
			${subQuery}
			/*
			, SUM(CASE WHEN MEMBER_ID = '2b_soil' THEN ISNULL(USER_CNT,0) ELSE 0 END) AS CNT1 -- 멤버십개수만큼 필요
			, SUM(CASE WHEN MEMBER_ID = '2b_soil' THEN ISNULL(USER_CNT,0) ELSE 0 END) AS CNT2
			, SUM(CASE WHEN MEMBER_ID = '2b_soil' THEN ISNULL(USER_CNT,0) ELSE 0 END) AS CNT3
			, SUM(CASE WHEN MEMBER_ID = '2b_soil' THEN ISNULL(USER_CNT,0) ELSE 0 END) AS CNT4
			*/
		FROM MW_MS_MEMB_DAY_STAT
			WHERE STAT_TYPE = '01' 

			<if test='ra_searchTerm!=null and ra_searchTerm!="" and ra_searchTerm!="all"'>
				<if test='sdate!=null and sdate!=""'>
					<if test='se_termOpt == "dayDate"'>
						<![CDATA[
							AND CONVERT(VARCHAR(8), STAT_DAY, 112) >=	REPLACE(#{sdate}, '-', '')
						]]>
					</if>
					<if test='edate!=null and edate!=""'>
						<if test='se_termOpt == "dayDate"'>
							<![CDATA[
								AND CONVERT(VARCHAR(8), STAT_DAY, 112) <=	REPLACE(#{edate}, '-', '')
							]]>
						</if>
					</if>
				</if>
			</if>
<!-- 
		<if test='name!=null and name!=""'>
			AND NAME LIKE '%${name}%'
		</if>
 -->
			GROUP BY STAT_DAY

	</select>
	

	<!-- 가입통계 일반통계 월별 -->
	<select id="selectMemberJoinNomalStaticMonthList" parameterType="map" resultMap="dataMap">
		SELECT 
			  MEMB_ID
			, NAME
			${subQuery}
			/*
			, SUM(CASE WHEN STAT_MONTH = '201209' THEN ISNULL(USER_CNT,0) ELSE 0 END) AS CNT1 -- 기간만큼 필요
			, SUM(CASE WHEN STAT_MONTH = SUBSTRING( REPLACE(CONVERT(VARCHAR(50),DATEADD(M,+1,CONVERT(datetime,'201209'+'01')),120),'-',''),1,6) THEN ISNULL(USER_CNT,0) ELSE 0 END) AS CNT2
			, SUM(CASE WHEN STAT_MONTH = SUBSTRING( REPLACE(CONVERT(VARCHAR(50),DATEADD(M,+2,CONVERT(datetime,'201209'+'01')),120),'-',''),1,6) THEN ISNULL(USER_CNT,0) ELSE 0 END) AS CNT3
			, SUM(CASE WHEN STAT_MONTH = SUBSTRING( REPLACE(CONVERT(VARCHAR(50),DATEADD(M,+3,CONVERT(datetime,'201209'+'01')),120),'-',''),1,6) THEN ISNULL(USER_CNT,0) ELSE 0 END) AS CNT4
			, SUM(ISNULL(USER_CNT,0)) AS SUM_CNT -- 합계
			*/			
		FROM MW_MS_MEMB_MONTH_STAT

		WHERE STAT_TYPE = '01' 

		<if test='name!=null and name!=""'>
			AND NAME LIKE '%${name}%'
		</if>
		GROUP BY MEMB_ID, NAME

	</select>
	

	<!-- 가입통계 단말기 OS/통신사 통계 월별 -->
	<select id="selectMemberJoinOSStaticMonthList" parameterType="map" resultMap="dataMap">
		SELECT 
		  MEMB_ID
		    , NAME
			, CASE WHEN OS_TYPE='01' THEN  '안드로이드' WHEN OS_TYPE='02' THEN '아이폰' END AS OS_TYPE
			, CASE WHEN MO_TYPE='01' THEN  'KT' WHEN MO_TYPE='02' THEN 'SKT' WHEN MO_TYPE='03' THEN 'LGU' END AS MO_TYPE
			${subQuery}
			/*
		    , SUM(CASE WHEN STAT_MONTH = '201209' THEN ISNULL(USER_CNT,0) ELSE 0 END) AS CNT1 
		    , SUM(CASE WHEN STAT_MONTH = SUBSTRING( REPLACE(CONVERT(VARCHAR(50),DATEADD(M,+1,CONVERT(datetime,'201209'+'01')),120),'-',''),1,6) THEN ISNULL(USER_CNT,0) ELSE 0 END) AS CNT2
		    , SUM(CASE WHEN STAT_MONTH = SUBSTRING( REPLACE(CONVERT(VARCHAR(50),DATEADD(M,+2,CONVERT(datetime,'201209'+'01')),120),'-',''),1,6) THEN ISNULL(USER_CNT,0) ELSE 0 END) AS CNT3
		    , SUM(CASE WHEN STAT_MONTH = SUBSTRING( REPLACE(CONVERT(VARCHAR(50),DATEADD(M,+3,CONVERT(datetime,'201209'+'01')),120),'-',''),1,6) THEN ISNULL(USER_CNT,0) ELSE 0 END) AS CNT4
		    , SUM(ISNULL(USER_CNT,0)) AS SUM_CNT -- 합계
		    */
	    FROM MW_MS_MEMB_MONTH_STAT_OS_MO

	    WHERE STAT_TYPE = '01' 

		<if test='name!=null and name!=""'>
			AND NAME LIKE '%${name}%'
		</if>
		GROUP BY MEMB_ID, NAME, OS_TYPE, MO_TYPE
		ORDER BY MEMB_ID, NAME, OS_TYPE, MO_TYPE
		
	</select>
	

	<!-- 가입통계 연령/성별 통계 월별 -->
	<select id="selectMemberJoinAgeStaticMonthList" parameterType="map" resultMap="dataMap">
		SELECT 
		   MEMB_ID
		  , NAME
		  , AGE_TYPE   
		  , SEX_TYPE  
			${subQuery}
		  /*
		  , SUM(CASE WHEN STAT_MONTH = '201209' THEN ISNULL(USER_CNT,0) ELSE 0 END) AS CNT1 -- 기간만큼 필요
		  , SUM(CASE WHEN STAT_MONTH = SUBSTRING( REPLACE(CONVERT(VARCHAR(50),DATEADD(M,+1,CONVERT(datetime,'201209'+'01')),120),'-',''),1,6) THEN ISNULL(USER_CNT,0) ELSE 0 END) AS CNT2
		  , SUM(CASE WHEN STAT_MONTH = SUBSTRING( REPLACE(CONVERT(VARCHAR(50),DATEADD(M,+2,CONVERT(datetime,'201209'+'01')),120),'-',''),1,6) THEN ISNULL(USER_CNT,0) ELSE 0 END) AS CNT3
		  , SUM(CASE WHEN STAT_MONTH = SUBSTRING( REPLACE(CONVERT(VARCHAR(50),DATEADD(M,+3,CONVERT(datetime,'201209'+'01')),120),'-',''),1,6) THEN ISNULL(USER_CNT,0) ELSE 0 END) AS CNT4
		  , SUM(ISNULL(USER_CNT,0)) AS SUM_CNT -- 합계
		  */
		FROM MW_MS_MEMB_MONTH_STAT_AGE_SEX
		  WHERE STAT_TYPE = '01' 
		
		<if test='name!=null and name!=""'>
			AND NAME LIKE '%${name}%'
		</if>
			GROUP BY MEMB_ID, NAME, AGE_TYPE, SEX_TYPE
			ORDER BY MEMB_ID, NAME, AGE_TYPE, SEX_TYPE
	</select>
	
</mapper>