<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.wallet.membership.mapper.custom.MemberMapper" >
	<resultMap id="BaseResultMap" type="com.wallet.membership.model.custom.Member" >
	<!--
	WARNING - @mbggenerated
	This element is automatically generated by MyBatis Generator, do not modify.
	This element was generated on Tue Aug 14 13:40:21 KST 2012.
	-->
		<result column="IDX" property="idx" jdbcType="VARCHAR" />

		<result column="MEMB_ID" property="membId" jdbcType="VARCHAR" />
		<result column="MEMB_CODE" property="membCode" jdbcType="VARCHAR" />
		<result column="SUB_YN" property="subYN" jdbcType="VARCHAR" />
		<result column="DIS_SDAY" property="disSday" jdbcType="VARCHAR" />
		<result column="STAT" property="stat" jdbcType="VARCHAR" />
		<result column="CATE_ID" property="cateId" jdbcType="VARCHAR" />
		<result column="CATE_NAME" property="cateName" jdbcType="VARCHAR" />
		<result column="NAME" property="name" jdbcType="VARCHAR" />
		<result column="INFO" property="info" jdbcType="VARCHAR" />
		<result column="SHOP_DESC" property="shopDesc" jdbcType="VARCHAR" />
		<result column="DIS_EDAY" property="disEday" jdbcType="VARCHAR" />
		<result column="MEMO" property="memo" jdbcType="VARCHAR" />
		<result column="REG_USER" property="regUser" jdbcType="VARCHAR" />
		<result column="PNT_TYPE" property="pntType" jdbcType="VARCHAR" />
		<result column="REG_DAY" property="regDay" jdbcType="VARCHAR" />
		<result column="CHG_USER" property="chgUser" jdbcType="VARCHAR" />
		<result column="CHG_DAY" property="chgDay" jdbcType="VARCHAR" />
		<result column="MAINDIS_YN" property="maindisYN" jdbcType="VARCHAR" />
		<result column="MAIN_IDX" property="mainIdx" jdbcType="VARCHAR" />
		<result column="MYDIS_YN" property="myDisYN" jdbcType="VARCHAR" />
		<result column="SHOP_YN" property="shopYN" jdbcType="VARCHAR" />
		<result column="CPN_YN" property="cpnYN" jdbcType="VARCHAR" />
		<result column="EVT_YN" property="evtYN" jdbcType="VARCHAR" />
		<result column="NEW_YN" property="newYN" jdbcType="VARCHAR" />
		<result column="DISPLAY_YN" property="displayYN" jdbcType="VARCHAR" />
		<result column="LINK_YN" property="linkYN" jdbcType="VARCHAR" />
		<result column="CDMA_YN" property="cdmaYN" jdbcType="VARCHAR" />
		<result column="MTYPE" property="mType" jdbcType="VARCHAR" />
		<result column="INFO_URL" property="infoUrl" jdbcType="VARCHAR" />
		<result column="SMS_YN" property="smsYN" jdbcType="VARCHAR" />
		<result column="EMAIL_YN" property="emailYN" jdbcType="VARCHAR" />
		<result column="PASS_YN" property="passYN" jdbcType="VARCHAR" />
		<result column="USIM_MODE" property="usimMode" jdbcType="VARCHAR" />
		<result column="APP_URL" property="appUrl" jdbcType="VARCHAR" />
		<result column="USIM_ID" property="usimId" jdbcType="VARCHAR" />
		<result column="MULTI_YN" property="multiYN" jdbcType="VARCHAR" />
		<result column="MULTI_CNT" property="multiCnt" jdbcType="VARCHAR" />
		<result column="MEMB_TYPE" property="membType" jdbcType="VARCHAR" />
		<result column="ENG_NAME_YN" property="engNameYN" jdbcType="VARCHAR" />
		<result column="JOIN_URL" property="joinUrl" jdbcType="VARCHAR" />
		<result column="NOTI_URL" property="notiUrl" jdbcType="VARCHAR" />
		<result column="JEHYU_ID" property="jehyuId" jdbcType="VARCHAR" />
		<result column="JEHYU_NM" property="jehyuNm" jdbcType="VARCHAR" />
		<result column="BRAN_ID" property="branId" jdbcType="VARCHAR" />
		<result column="BRAN_NM" property="branNm" jdbcType="VARCHAR" />
		<result column="RECOMM_YN" property="recommYN" jdbcType="VARCHAR" />
		<result column="RECOMM_SEQ" property="recommSeq" jdbcType="VARCHAR" />
		<result column="CHG_TM" property="chgTm" jdbcType="VARCHAR" />
		<result column="POPU_SEQ" property="popuSeq" jdbcType="VARCHAR" />
		
		<result column="POINT_TYPE" property="pointType" jdbcType="CHAR" />
		<result column="BAR_TYPE" property="barType" jdbcType="CHAR" />
		<result column="CLASS_YN" property="classYN" jdbcType="CHAR" />
		<result column="CLASS_CNT" property="classCnt" jdbcType="CHAR" />
		<result column="UPPER_MEMB_ID" property="upperMembId" jdbcType="VARCHAR" />
		<result column="SHOPINFO_YN" property="shopinfoYN" jdbcType="CHAR" />
		<result column="SHOPINFO_URL" property="shopinfoUrl" jdbcType="VARCHAR" />	
		<result column="DESC_USE_URL" property="descUseUrl" jdbcType="VARCHAR" />	
		<result column="TERMS_CNT" property="termsCnt" jdbcType="VARCHAR" />
		
		<result column="MEM_LIST_3GS" property="listImg_i3GS" jdbcType="VARCHAR" />
		<result column="MEM_LIST_4S" property="listImg_i4S" jdbcType="VARCHAR" />
		<result column="MEM_LIST_ANDROID" property="listImg_android" jdbcType="VARCHAR" />

		<result column="MEM_DETAIL_3GS" property="detailImg_i3GS" jdbcType="VARCHAR" />
		<result column="MEM_DETAIL_4S" property="detailImg_i4S" jdbcType="VARCHAR" />
		<result column="MEM_DETAIL_ANDROID" property="detailImg_android" jdbcType="VARCHAR" />

		<result column="MEMBER_3GS" property="memberImg_i3GS" jdbcType="VARCHAR" />
		<result column="MEMBER_4S" property="memberImg_i4S" jdbcType="VARCHAR" />
		<result column="MEMBER_ANDROID" property="memberImg_android" jdbcType="VARCHAR" />

		<result column="REG_USER_NM" property="regUserNm" jdbcType="VARCHAR" />
		<result column="CHG_USER_NM" property="chgUserNm" jdbcType="VARCHAR" />
		
		<result column="MEMB_JOIN_YN" property="membJoinYN" jdbcType="VARCHAR" />
		<result column="MEMB_JOIN_N_MSG" property="membJoinNMsg" jdbcType="VARCHAR" />
	</resultMap>

	<!-- 조회조건에 대한 멤버십 목록 -->
	<select id="selectMemberList" parameterType="HashMap" resultMap="BaseResultMap" >
		SELECT <if test='top != null and top != ""'> top ${top} </if>  K.*
		FROM 
		(
			SELECT ROW_NUMBER() OVER(ORDER BY A.REG_DAY DESC) AS IDX, A.*, B.CNT AS MULTI_CNT, C.CNT AS TERMS_CNT, D.CNT AS CLASS_CNT
			FROM (
					SELECT  S.MEMB_ID
					, S.MEMB_CODE
					, S.SUB_YN
					, LEFT(S.DIS_SDAY, 4) + '-' + RIGHT(LEFT(S.DIS_SDAY, 6), 2) + '-' + RIGHT(S.DIS_SDAY, 2) DIS_SDAY
					, S.STAT
					, S.CATE_ID
					, dbo.GET_CODE_NM('0013', S.CATE_ID) AS CATE_NAME
					, S.NAME
					, S.INFO
					, S.SHOP_DESC
					, LEFT(S.DIS_EDAY, 4) + '-' + RIGHT(LEFT(S.DIS_EDAY, 6), 2) + '-' + RIGHT(S.DIS_EDAY, 2) DIS_EDAY
					, S.MEMO
					, S.PNT_TYPE
					, LEFT(S.REG_DAY, 4) + '-' + RIGHT(LEFT(S.REG_DAY, 6), 2) + '-' + RIGHT(S.REG_DAY, 2) REG_DAY
					, S.CHG_USER
					, LEFT(S.CHG_DAY, 4) + '-' + RIGHT(LEFT(S.CHG_DAY, 6), 2) + '-' + RIGHT(S.CHG_DAY, 2) CHG_DAY
					, S.MAINDIS_YN
					, S.MAIN_IDX
					, S.MYDIS_YN
					, S.SHOP_YN
					, S.CPN_YN
					, S.EVT_YN
					, S.NEW_YN
					, S.DISPLAY_YN
					, S.LINK_YN
					, S.CDMA_YN
					, S.MTYPE
					, S.INFO_URL
					, S.SMS_YN
					, S.EMAIL_YN
					, S.PASS_YN
					, S.USIM_MODE
					, S.APP_URL
					, S.USIM_ID
					, S.MULTI_YN 
					, S.MEMB_TYPE
					, S.ENG_NAME_YN
					, S.JOIN_URL
					, S.NOTI_URL
					, S.COMP_ID AS JEHYU_ID
					, dbo.GET_COMP_NM(S.COMP_ID) AS JEHYU_NM
					, S.BRAN_ID 
					, dbo.GET_COMP_NM(S.BRAN_ID) AS BRAN_NM
					, S.RECOMM_YN
					, S.RECOMM_SEQ
					, LEFT(S.CHG_TM, 4) + '-' + RIGHT(LEFT(S.CHG_TM, 4), 2) + '-' + RIGHT(S.CHG_TM, 2) CHG_TM
					, S.POPU_SEQ
					, S.POINT_TYPE
					, S.BAR_TYPE
					, S.CLASS_YN
					, S.SHOPINFO_YN
					, S.SHOPINFO_URL
					, S.UPPER_MEMB_ID
					, S.MEMB_JOIN_YN
					, S.MEMB_JOIN_N_MSG
					, I.*
					
					/*, U1.AUTH_NAME AS REG_USER_NM*/
					/*, U2.AUTH_NAME AS CHG_USER_NM*/
				/*FROM MEMB_CARDLIST S,*/
				FROM MEMB_CARDLIST S
				LEFT OUTER JOIN
				(
					SELECT ID
						, MAX(CASE WHEN I.OS_TYPE='01' AND I.USE_TYPE='02' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEM_LIST_3GS
						, MAX(CASE WHEN I.OS_TYPE='02' AND I.USE_TYPE='02' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEM_LIST_4S
						, MAX(CASE WHEN I.OS_TYPE='11' AND I.USE_TYPE='02' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEM_LIST_ANDROID
						, MAX(CASE WHEN I.OS_TYPE='01' AND I.USE_TYPE='03' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEM_DETAIL_3GS
						, MAX(CASE WHEN I.OS_TYPE='02' AND I.USE_TYPE='03' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEM_DETAIL_4S
						, MAX(CASE WHEN I.OS_TYPE='11' AND I.USE_TYPE='03' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEM_DETAIL_ANDROID
						, MAX(CASE WHEN I.OS_TYPE='01' AND I.USE_TYPE='04' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEMBER_3GS
						, MAX(CASE WHEN I.OS_TYPE='02' AND I.USE_TYPE='04' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEMBER_4S
						, MAX(CASE WHEN I.OS_TYPE='11' AND I.USE_TYPE='04' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEMBER_ANDROID
					FROM MW_CM_IMAGE I
					GROUP BY ID
				) I /*, USER_DESC U1, USER_DESC U2*/
				/*WHERE S.MEMB_ID = I.ID*/
				ON S.MEMB_ID = I.ID
				WHERE 1 = 1
				/*
				AND U1.USER_ID = S.REG_USER
				AND U2.USER_ID = S.CHG_USER
				*/
				<if test='membId != null and membId != ""'>
					AND S.MEMB_ID = #{membId}
				</if>
				<if test='ra_searchTerm != null and ra_searchTerm != "" and ra_searchTerm != "all"'>
					<if test='sdate != null and sdate != ""'>
						<if test='se_termOpt == "reg_date"'>
							<![CDATA[
								AND S.REG_DAY >= REPLACE(#{sdate}, '-', '')	
							]]>
						</if>
						<if test='se_termOpt == "chg_date"'>
							<![CDATA[
								AND S.CHG_DAY >= REPLACE(#{sdate}, '-', '')
							]]>
						</if>
						<if test='se_termOpt == "dis_Sdate"'>
							<![CDATA[
								AND S.DIS_SDAY >= REPLACE(#{sdate}, '-', '')
							]]>
						</if>
						<if test='se_termOpt == "dis_Edate"'>
							<![CDATA[
								AND S.DIS_EDAY >= REPLACE(#{sdate}, '-', '')
							]]>
						</if>
					</if>
						
					<if test='edate != null and edate != ""'>
						<if test='se_termOpt == "reg_date"'>
							<![CDATA[
								AND S.REG_DAY <= REPLACE(#{edate}, '-', '')
							]]>
						</if>
						<if test='se_termOpt == "chg_date"'>
							<![CDATA[
								AND S.CHG_DAY <= REPLACE(#{edate}, '-', '')
							]]>
						</if>
						<if test='se_termOpt == "dis_Sdate"'>
							<![CDATA[
								AND S.DIS_SDAY <= REPLACE(#{edate}, '-', '')
							]]>
						</if>
						<if test='se_termOpt == "dis_Edate"'>
							<![CDATA[
								AND S.DIS_EDAY <= REPLACE(#{edate}, '-', '')
							]]>
						</if>
					</if>
				</if>
				<if test='se_termOpt == "chg_date"'>
				AND S.CHG_DAY IS NOT NULL
				</if>
				<if test='seName != null and seName != ""'>
				AND S.NAME LIKE '%${seName}%'
				</if>
				<if test='ra_stat != null and ra_stat != "" and ra_stat != "all"'>
					AND S.STAT = #{ra_stat}
				</if>
				) A
				LEFT OUTER JOIN (
					SELECT UPPER_MEMB_ID, COUNT(*)+1 AS CNT 
					FROM MEMB_CARDLIST
					WHERE UPPER_MEMB_ID IS NOT NULL
					GROUP BY UPPER_MEMB_ID
				) B ON A.MEMB_ID = B.UPPER_MEMB_ID
				LEFT OUTER JOIN (
					SELECT MEMB_ID, COUNT(MEMB_ID) AS CNT
					FROM MW_MS_MEMB_AGREE
					GROUP BY MEMB_ID
				) C ON A.MEMB_ID = C.MEMB_ID
				LEFT OUTER JOIN (
					SELECT MEMB_ID, COUNT(MEMB_ID) AS CNT
					FROM MW_MS_MEMB_CLASS
					GROUP BY MEMB_ID
				) D ON A.MEMB_ID = D.MEMB_ID
			WHERE 1=1
			<if test='upperMembId == null or upperMembId == ""'>
				AND A.UPPER_MEMB_ID IS NULL
			</if>
			<if test='upperMembId != null and upperMembId != ""'>
				AND A.UPPER_MEMB_ID = #{upperMembId}
			</if>
		) K
		WHERE 1=1
		<if test='startRow != null and startRow != ""'>
			<if test='rowsPerPage != null and rowsPerPage != ""'>
				AND K.IDX BETWEEN #{startRow, jdbcType=INTEGER} AND #{endRow, jdbcType=INTEGER}
			</if>
		</if>
	</select>
	
	<!-- 조회조건에 대한 멤버십 총 수 -->
	<select id="selectMemberListCnt" parameterType="HashMap" resultType="java.lang.Integer">
		SELECT COUNT(*) AS CNT
		FROM (
			SELECT S.MEMB_ID
				, S.MEMB_CODE
				, S.SUB_YN
				, LEFT(S.DIS_SDAY, 4) + '-' + RIGHT(LEFT(S.DIS_SDAY, 6), 2) + '-' + RIGHT(S.DIS_SDAY, 2) DIS_SDAY
				, S.STAT
				, S.CATE_ID
				, dbo.GET_CODE_NM('0013', S.CATE_ID) AS CATE_NAME
				, S.NAME
				, S.INFO
				, S.SHOP_DESC
				, LEFT(S.DIS_EDAY, 4) + '-' + RIGHT(LEFT(S.DIS_EDAY, 6), 2) + '-' + RIGHT(S.DIS_EDAY, 2) DIS_EDAY
				, S.MEMO
				, S.PNT_TYPE
				, LEFT(S.REG_DAY, 4) + '-' + RIGHT(LEFT(S.REG_DAY, 6), 2) + '-' + RIGHT(S.REG_DAY, 2) REG_DAY
				, S.CHG_USER
				, LEFT(S.CHG_DAY, 4) + '-' + RIGHT(LEFT(S.CHG_DAY, 6), 2) + '-' + RIGHT(S.CHG_DAY, 2) CHG_DAY
				, S.MAINDIS_YN
				, S.MAIN_IDX
				, S.MYDIS_YN
				, S.SHOP_YN
				, S.CPN_YN
				, S.EVT_YN
				, S.NEW_YN
				, S.DISPLAY_YN
				, S.LINK_YN
				, S.CDMA_YN
				, S.MTYPE
				, S.INFO_URL
				, S.SMS_YN
				, S.EMAIL_YN
				, S.PASS_YN
				, S.USIM_MODE
				, S.APP_URL
				, S.USIM_ID
				, S.MULTI_YN 
				, S.MEMB_TYPE
				, S.ENG_NAME_YN
				, S.JOIN_URL
				, S.NOTI_URL
				, S.COMP_ID AS JEHYU_ID
				, dbo.GET_COMP_NM(S.COMP_ID) AS JEHYU_NM
				, S.BRAN_ID 
				, dbo.GET_COMP_NM(S.BRAN_ID) AS BRAN_NM
				, S.RECOMM_YN
				, S.RECOMM_SEQ
				, LEFT(S.CHG_TM, 4) + '-' + RIGHT(LEFT(S.CHG_TM, 4), 2) + '-' + RIGHT(S.CHG_TM, 2) CHG_TM
				, S.POPU_SEQ
				, S.POINT_TYPE
				, S.BAR_TYPE
				, S.CLASS_YN
				, S.SHOPINFO_YN
				, S.SHOPINFO_URL
				, S.UPPER_MEMB_ID
				, S.MEMB_JOIN_YN
				, S.MEMB_JOIN_N_MSG
				, I.*
				
				/*, U1.AUTH_NAME AS REG_USER_NM*/
				/*, U2.AUTH_NAME AS CHG_USER_NM*/
			FROM MEMB_CARDLIST S
			LEFT OUTER JOIN
			(
				SELECT ID
					, MAX(CASE WHEN I.OS_TYPE='01' AND I.USE_TYPE='02' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEM_LIST_3GS
					, MAX(CASE WHEN I.OS_TYPE='02' AND I.USE_TYPE='02' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEM_LIST_4S
					, MAX(CASE WHEN I.OS_TYPE='11' AND I.USE_TYPE='02' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEM_LIST_ANDROID
					, MAX(CASE WHEN I.OS_TYPE='01' AND I.USE_TYPE='03' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEM_DETAIL_3GS
					, MAX(CASE WHEN I.OS_TYPE='02' AND I.USE_TYPE='03' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEM_DETAIL_4S
					, MAX(CASE WHEN I.OS_TYPE='11' AND I.USE_TYPE='03' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEM_DETAIL_ANDROID
					, MAX(CASE WHEN I.OS_TYPE='01' AND I.USE_TYPE='04' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEMBER_3GS
					, MAX(CASE WHEN I.OS_TYPE='02' AND I.USE_TYPE='04' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEMBER_4S
					, MAX(CASE WHEN I.OS_TYPE='11' AND I.USE_TYPE='04' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEMBER_ANDROID
				FROM MW_CM_IMAGE I
				GROUP BY ID
			) I /*, USER_DESC U1, USER_DESC U2*/
			ON S.MEMB_ID = I.ID
			WHERE 1=1
			/*
			AND U1.USER_ID = S.REG_USER
			AND U2.USER_ID = S.CHG_USER
			*/
			<if test='membId != null and membId != ""'>
				AND S.MEMB_ID = #{membId}
			</if>
			<if test='ra_searchTerm != null and ra_searchTerm != "" and ra_searchTerm != "all"'>
				<if test='sdate != null and sdate != ""'>
					<if test='se_termOpt == "reg_date"'>
						<![CDATA[
							AND S.REG_DAY >= REPLACE(#{sdate}, '-', '')	
						]]>
					</if>
					<if test='se_termOpt == "chg_date"'>
						<![CDATA[
							AND S.CHG_DAY >= REPLACE(#{sdate}, '-', '')
						]]>
					</if>
					<if test='se_termOpt == "dis_Sdate"'>
						<![CDATA[
							AND S.DIS_SDAY >= REPLACE(#{sdate}, '-', '')
						]]>
					</if>
					<if test='se_termOpt == "dis_Edate"'>
						<![CDATA[
							AND S.DIS_EDAY >= REPLACE(#{sdate}, '-', '')
						]]>
					</if>
				</if>
					
				<if test='edate != null and edate != ""'>
					<if test='se_termOpt == "reg_date"'>
						<![CDATA[
							AND S.REG_DAY <= REPLACE(#{edate}, '-', '')
						]]>
					</if>
					<if test='se_termOpt == "chg_date"'>
						<![CDATA[
							AND S.CHG_DAY <= REPLACE(#{edate}, '-', '')
						]]>
					</if>
					<if test='se_termOpt == "dis_Sdate"'>
						<![CDATA[
							AND S.DIS_SDAY <= REPLACE(#{edate}, '-', '')
						]]>
					</if>
					<if test='se_termOpt == "dis_Edate"'>
						<![CDATA[
							AND S.DIS_EDAY <= REPLACE(#{edate}, '-', '')
						]]>
					</if>
				</if>
			</if>
			<if test='se_termOpt == "chg_date"'>
			AND S.CHG_DAY IS NOT NULL
			</if>
			<if test='seName != null and seName != ""'>
			AND S.NAME LIKE '%${seName}%'
			</if>
			<if test='ra_stat != null and ra_stat != "" and ra_stat != "all"'>
				AND S.STAT = #{ra_stat}
			</if>
		)A
			LEFT OUTER JOIN (
				SELECT UPPER_MEMB_ID, COUNT(*)+1 AS CNT 
				FROM MEMB_CARDLIST
				WHERE UPPER_MEMB_ID IS NOT NULL
				GROUP BY UPPER_MEMB_ID
			) B ON A.MEMB_ID = B.UPPER_MEMB_ID
			LEFT OUTER JOIN (
				SELECT MEMB_ID, COUNT(MEMB_ID) AS CNT
				FROM MW_MS_MEMB_AGREE
				GROUP BY MEMB_ID
			) C ON A.MEMB_ID = C.MEMB_ID
			LEFT OUTER JOIN(
				SELECT MEMB_ID, COUNT(MEMB_ID) AS CNT
				FROM MW_MS_MEMB_CLASS
				GROUP BY MEMB_ID
			) D ON A.MEMB_iD = D.MEMB_ID
		WHERE 1=1
		<if test='upperMembId == null or upperMembId == ""'>
				AND A.UPPER_MEMB_ID IS NULL
		</if>
		<if test='upperMembId != null and upperMembId != ""'>
			AND A.UPPER_MEMB_ID = #{upperMembId}
		</if>
	</select>
	
	<!-- 조회조건에 대한 멤버십 목록 -->
	<select id="selectMemberInfo" parameterType="HashMap" resultMap="BaseResultMap" >
		SELECT  A.*, B.CNT AS MULTI_CNT, C.CNT AS TERMS_CNT, D.CNT AS CLASS_CNT
			FROM (
					SELECT  S.MEMB_ID
					, S.MEMB_CODE
					, S.SUB_YN
					, LEFT(S.DIS_SDAY, 4) + '-' + RIGHT(LEFT(S.DIS_SDAY, 6), 2) + '-' + RIGHT(S.DIS_SDAY, 2) DIS_SDAY
					, S.STAT
					, S.CATE_ID
					, dbo.GET_CODE_NM('0013', S.CATE_ID) AS CATE_NAME
					, S.NAME
					, S.INFO
					, S.SHOP_DESC
					, LEFT(S.DIS_EDAY, 4) + '-' + RIGHT(LEFT(S.DIS_EDAY, 6), 2) + '-' + RIGHT(S.DIS_EDAY, 2) DIS_EDAY
					, S.MEMO
					, S.PNT_TYPE
					, LEFT(S.REG_DAY, 4) + '-' + RIGHT(LEFT(S.REG_DAY, 6), 2) + '-' + RIGHT(S.REG_DAY, 2) REG_DAY
					, S.CHG_USER
					, LEFT(S.CHG_DAY, 4) + '-' + RIGHT(LEFT(S.CHG_DAY, 6), 2) + '-' + RIGHT(S.CHG_DAY, 2) CHG_DAY
					, S.MAINDIS_YN
					, S.MAIN_IDX
					, S.MYDIS_YN
					, S.SHOP_YN
					, S.CPN_YN
					, S.EVT_YN
					, S.NEW_YN
					, S.DISPLAY_YN
					, S.LINK_YN
					, S.CDMA_YN
					, S.MTYPE
					, S.INFO_URL
					, S.SMS_YN
					, S.EMAIL_YN
					, S.PASS_YN
					, S.USIM_MODE
					, S.APP_URL
					, S.USIM_ID
					, S.MULTI_YN 
					, S.MEMB_TYPE
					, S.ENG_NAME_YN
					, S.JOIN_URL
					, S.NOTI_URL
					, S.COMP_ID AS JEHYU_ID
					, dbo.GET_COMP_NM(S.COMP_ID) AS JEHYU_NM
					, S.BRAN_ID 
					, dbo.GET_COMP_NM(S.BRAN_ID) AS BRAN_NM
					, S.RECOMM_YN
					, S.RECOMM_SEQ
					, LEFT(S.CHG_TM, 4) + '-' + RIGHT(LEFT(S.CHG_TM, 4), 2) + '-' + RIGHT(S.CHG_TM, 2) CHG_TM
					, S.POPU_SEQ
					, S.POINT_TYPE
					, S.BAR_TYPE
					, S.CLASS_YN
					, S.SHOPINFO_YN
					, S.SHOPINFO_URL
					, S.UPPER_MEMB_ID
					, S.MEMB_JOIN_YN
					, S.MEMB_JOIN_N_MSG
					, I.*
					
					/*, U1.AUTH_NAME AS REG_USER_NM*/
					/*, U2.AUTH_NAME AS CHG_USER_NM*/
				FROM MEMB_CARDLIST S
				LEFT OUTER JOIN
				(
					SELECT ID
						, MAX(CASE WHEN I.OS_TYPE='01' AND I.USE_TYPE='02' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEM_LIST_3GS
						, MAX(CASE WHEN I.OS_TYPE='02' AND I.USE_TYPE='02' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEM_LIST_4S
						, MAX(CASE WHEN I.OS_TYPE='11' AND I.USE_TYPE='02' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEM_LIST_ANDROID
						, MAX(CASE WHEN I.OS_TYPE='01' AND I.USE_TYPE='03' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEM_DETAIL_3GS
						, MAX(CASE WHEN I.OS_TYPE='02' AND I.USE_TYPE='03' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEM_DETAIL_4S
						, MAX(CASE WHEN I.OS_TYPE='11' AND I.USE_TYPE='03' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEM_DETAIL_ANDROID
						, MAX(CASE WHEN I.OS_TYPE='01' AND I.USE_TYPE='04' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEMBER_3GS
						, MAX(CASE WHEN I.OS_TYPE='02' AND I.USE_TYPE='04' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEMBER_4S
						, MAX(CASE WHEN I.OS_TYPE='11' AND I.USE_TYPE='04' THEN /*I.IMAGE_HOST+*/I.IMAGE_URL END) AS MEMBER_ANDROID
					FROM MW_CM_IMAGE I
					GROUP BY ID
				) I /*, USER_DESC U1, USER_DESC U2*/
				ON S.MEMB_ID = I.ID
				WHERE 1=1
				/*
				AND U1.USER_ID = S.REG_USER
				AND U2.USER_ID = S.CHG_USER
				*/
				AND S.MEMB_ID = #{membId}
				<if test='ra_searchTerm != null and ra_searchTerm != "" and ra_searchTerm != "all"'>
					<if test='sdate != null and sdate != ""'>
						<if test='se_termOpt == "reg_date"'>
							<![CDATA[
								AND S.REG_DAY >= REPLACE(#{sdate}, '-', '')	
							]]>
						</if>
						<if test='se_termOpt == "chg_date"'>
							<![CDATA[
								AND S.CHG_DAY >= REPLACE(#{sdate}, '-', '')
							]]>
						</if>
						<if test='se_termOpt == "dis_Sdate"'>
							<![CDATA[
								AND S.DIS_SDAY >= REPLACE(#{sdate}, '-', '')
							]]>
						</if>
						<if test='se_termOpt == "dis_Edate"'>
							<![CDATA[
								AND S.DIS_EDAY >= REPLACE(#{sdate}, '-', '')
							]]>
						</if>
					</if>
						
					<if test='edate != null and edate != ""'>
						<if test='se_termOpt == "reg_date"'>
							<![CDATA[
								AND S.REG_DAY <= REPLACE(#{edate}, '-', '')
							]]>
						</if>
						<if test='se_termOpt == "chg_date"'>
							<![CDATA[
								AND S.CHG_DAY <= REPLACE(#{edate}, '-', '')
							]]>
						</if>
						<if test='se_termOpt == "dis_Sdate"'>
							<![CDATA[
								AND S.DIS_SDAY <= REPLACE(#{edate}, '-', '')
							]]>
						</if>
						<if test='se_termOpt == "dis_Edate"'>
							<![CDATA[
								AND S.DIS_EDAY <= REPLACE(#{edate}, '-', '')
							]]>
						</if>
					</if>
				</if>
				<if test='seName != null and seName != ""'>
					AND S.NAME LIKE '%${seName}%'
				</if>
				<if test='ra_stat != null and ra_stat != "" and ra_stat != "all"'>
					AND S.STAT = #{ra_stat}
				</if>
				) A
				LEFT OUTER JOIN (
					SELECT UPPER_MEMB_ID, COUNT(*)+1 AS CNT 
					FROM MEMB_CARDLIST
					WHERE UPPER_MEMB_ID IS NOT NULL
					GROUP BY UPPER_MEMB_ID
				) B ON A.MEMB_ID = B.UPPER_MEMB_ID
				LEFT OUTER JOIN (
					SELECT MEMB_ID, COUNT(MEMB_ID) AS CNT
					FROM MW_MS_MEMB_AGREE
					GROUP BY MEMB_ID
				) C ON A.MEMB_ID = C.MEMB_ID
				LEFT OUTER JOIN (
					SELECT MEMB_ID, COUNT(MEMB_ID) AS CNT
					FROM MW_MS_MEMB_CLASS
					GROUP BY MEMB_ID
				) D ON A.MEMB_ID = D.MEMB_ID
			WHERE 1=1
			
	</select>

	<insert id="insertMember" parameterType="HashMap">
		INSERT INTO MEMB_CARDLIST
		<trim prefix="(" suffix=")" suffixOverrides="," >
			MEMB_ID, 
			<if test='membCode != null and membCode != ""' >MEMB_CODE, </if>
			<if test='subYN != null and subYN != ""' >SUB_YN, </if>
			<if test='disSday != null and disSday != ""' >DIS_SDAY, </if>
			<if test='stat != null and stat != ""' >STAT, </if>
			<if test='cateId != null and cateId != ""' >CATE_ID, </if>
			<if test='name != null and name != ""' >NAME, </if>
			<if test='info != null and info != ""' >INFO, </if>
			<if test='shopDesc != null and shopDesc != ""' >SHOP_DESC, </if>
			<if test='disEday != null and disEday != ""' >DIS_EDAY, </if>
			<if test='memo != null and memo != ""' >MEMO, </if>

			REG_USER,
			<if test='pntType != null and pntType != ""' >PNT_TYPE, </if>
			REG_DAY,
			<if test='maindisYN != null and maindisYN != ""' >MAINDIS_YN, </if>
			<if test='mainIdx != null and mainIdx != ""' >MAIN_IDX, </if>
			<if test='myDisYN != null and myDisYN != ""' >MYDIS_YN, </if>
			<if test='shopYN != null and shopYN != ""' >SHOP_YN, </if>
			<if test='cpnYN != null and cpnYN != ""' >CPN_YN, </if>
			<if test='evtYN != null and evtYN != ""' >EVT_YN, </if>

			<if test='newYN != null and newYN != ""' >NEW_YN, </if>
			<if test='displayYN != null and displayYN != ""' >DISPLAY_YN, </if>
			<if test='linkYN != null and linkYN != ""' >LINK_YN, </if>
			<if test='cdmaYN != null and cdmaYN != ""' >CDMA_YN, </if>
			<if test='mType != null and mType != ""' >MTYPE, </if>
			<if test='infoUrl != null and infoUrl != ""' >INFO_URL, </if>
			<if test='smsYN != null and smsYN != ""' >SMS_YN, </if>
			<if test='emailYN != null and emailYN != ""' >EMAIL_YN, </if>
			<if test='passYN != null and passYN != ""' >PASS_YN, </if>
			<if test='usimMode != null and usimMode != ""' >USIM_MODE, </if>
			
			<if test='appUrl != null and appUrl != ""' >APP_URL, </if>
			<if test='usimId != null and usimId != ""' >USIM_ID, </if>
			<if test='multiYN != null and multiYN != ""' >MULTI_YN, </if>
			<if test='membType != null and membType != ""' >MEMB_TYPE, </if>
			<if test='engNameYN != null and engNameYN != ""' >ENG_NAME_YN, </if>
			<if test='notiUrl and notiUrl != ""' >NOTI_URL, </if>
			<if test='recommYN != null and recommYN != ""' >RECOMM_YN, </if>
			<if test='recommSeq != null and recommSeq != ""' >RECOMM_SEQ, </if>
			CHG_TM, 
			
			<if test='popuSeq != null and popuSeq != ""' >POPU_SEQ, </if>
			<if test='pointType != null and pointType != ""' >POINT_TYPE, </if>
			<if test='barType != null and barType != ""' >BAR_TYPE, </if>
			<if test='classYN != null and classYN != ""' >CLASS_YN, </if>
			<if test='upperMembId != null and upperMembId != ""' >UPPER_MEMB_ID, </if>
			<if test='shopinfoYN != null and shopinfoYN != ""' >SHOPINFO_YN, </if>
			<if test='shopinfoUrl != null and shopinfoUrl != ""' >SHOPINFO_URL, </if>
			<if test='jehyuId != null and jehyuId != ""' >COMP_ID, </if>
			<if test='branId != null and branId != ""' >BRAN_ID, </if>
			
			<if test='membJoinYN != null and membJoinYN != ""' >MEMB_JOIN_YN, </if>
			<if test='membJoinNMsg != null and membJoinNMsg != ""' >MEMB_JOIN_N_MSG, </if>
		</trim>
		<trim prefix="VALUES(" suffix=")" suffixOverrides="," >
			#{membId},

			<if test='membCode != null and membCode != ""' >#{membCode}, </if>
			<if test='subYN != null and subYN != ""' >#{subYN}, </if>
			<if test='disSday != null and disSday != ""' >REPLACE(#{disSday}, '-', ''), </if>
			<if test='stat != null and stat != ""' >#{stat}, </if>
			<if test='cateId != null and cateId != ""' >#{cateId}, </if>
			<if test='name != null and name != ""' >#{name}, </if>
			<if test='info != null and info != ""' >#{info}, </if>
			<if test='shopDesc != null and shopDesc != ""' >#{shopDesc}, </if>
			<if test='disSday != null and disSday != ""' >REPLACE(#{disEday}, '-', ''), </if>
			<if test='memo != null and memo != ""' >#{memo}, </if>

			#{regUser},
			<if test='pntType != null and pntType != ""' >#{pntType}, </if>
			REPLACE(CONVERT(VARCHAR(10), GETDATE(), 112), '-', ''),
			<if test='maindisYN != null and maindisYN != ""' > #{maindisYN}, </if>
			<if test='mainIdx != null and mainIdx != ""' > #{mainIdx}, </if>
			<if test='myDisYN != null and myDisYN != ""' >#{mydisYN}, </if>
			<if test='shopYN != null and shopYN != ""' >#{shopYN}, </if>
			<if test='cpnYN != null and cpnYN != ""' >#{cpnYN}, </if>
			<if test='evtYN != null and evtYN != ""' >#{evtYN}, </if>

			<if test='newYN != null and newYN != ""' >#{newYN}, </if>
			<if test='displayYN != null and displayYN != ""' >#{displayYN}, </if>
			<if test='linkYN != null and linkYN != ""' >#{linkYN}, </if>
			<if test='cdmaYN != null and cdmaYN != ""' >#{cdmaYN}, </if>
			<if test='mType != null and mType != ""' >#{mType}, </if>
			<if test='infoUrl != null and infoUrl != ""' >#{infoUrl}, </if>
			<if test='smsYN != null and smsYN != ""' >#{smsYN}, </if>
			<if test='emailYN != null and emailYN != ""' >#{emailYN}, </if>
			<if test='passYN != null and passYN != ""' >#{passYN}, </if>
			<if test='usimMode != null and usimMode != ""' >#{usimMode}, </if>

			<if test='appUrl != null and appUrl != ""' >#{appUrl}, </if>
			<if test='usimId != null and usimId != ""' >#{usimId}, </if>
			<if test='multiYN != null and multiYN != ""' >#{multiYN}, </if>
			<if test='membType != null and membType != ""' >#{membType}, </if>
			<if test='engNameYN != null and engNameYN != ""' >#{engNameYN}, </if>
			<if test='notiUrl and notiUrl != ""' >#{notiUrl}, </if>
			<if test='recommYN != null and recommYN != ""' >#{recommYN}, </if>
			<if test='recommSeq != null and recommSeq != ""' >#{recommSeq}, </if>
			REPLACE(CONVERT(VARCHAR(10), GETDATE(), 108), ':', ''),

			<if test='popuSeq != null and popuSeq != ""' >#{popuSeq}, </if>
			<if test='pointType != null and pointType != ""' >#{pointType}, </if>
			<if test='barType != null and barType != ""' >#{barType}, </if>
			<if test='classYN != null and classYN != ""' >#{classYN}, </if>
			<if test='upperMembId != null and upperMembId != ""' >#{upperMembId}, </if>
			<if test='shopinfoYN != null and shopinfoYN != ""' >#{shopinfoYN}, </if>
			<if test='shopinfoUrl != null and shopinfoUrl != ""' >#{shopinfoUrl}, </if>
			<if test='jehyuId != null and jehyuId != ""' >#{jehyuId}, </if>
			<if test='branId != null and branId != ""' >#{branId}, </if>
			
			<if test='membJoinYN != null and membJoinYN != ""' >#{membJoinYN}, </if>
			<if test='membJoinNMsg != null and membJoinNMsg != ""' >#{membJoinNMsg}, </if>
		</trim>
	</insert>

	<update id="updateMember" parameterType="HashMap">
		UPDATE MEMB_CARDLIST
		<set >
		<trim prefix="" suffix="" suffixOverrides="," >
			<if test='membCode != null and membCode != ""' >MEMB_CODE = #{membCode}, </if>
			<if test='subYN != null and subYN != ""' >SUB_YN = #{subYN}, </if>
			<if test='disSday != null and disSday != ""' >DIS_SDAY = REPLACE(#{disSday}, '-', ''), </if>
			<if test='stat != null and stat != ""' >STAT = #{stat}, </if>
			<if test='cateId != null and cateId != ""' >CATE_ID = #{cateId}, </if>
			<if test='name != null and name != ""' >NAME = #{name}, </if>
			<if test='info != null and info != ""' >INFO = #{info}, </if>
			<if test='shopDesc != null and shopDesc != ""' >SHOP_DESC = #{shopDesc}, </if>
			<if test='disEday != null and disEday != ""' >DIS_EDAY = REPLACE(#{disEday}, '-', ''),</if>
			<if test='memo != null and memo != ""' >MEMO = #{memo}, </if>
			<if test='regUser != null and regUser != ""' >REG_USER = #{regUser}, </if>
			<if test='pntType != null and pntType != ""' >PNT_TYPE = #{pntType}, </if>
			<if test='regDay != null and regDay != ""' >REG_DAY = #{regDay}, </if>
			
			<if test='maindisYN != null and maindisYN != ""' >MAINDIS_YN = #{maindisYN}, </if>
			<if test='maindisYN == ""' >MAINDIS_YN = NULL, </if>
			<if test='mainIdx != null and mainIdx != ""' >MAIN_IDX = #{mainIdx}, </if>
			<if test='mainIdx ==""'>MAIN_IDX = NULL, </if>
			
			<if test='myDisYN != null and myDisYN != ""' >MYDIS_YN = #{myDisYN}, </if>
			<if test='myDisYN == null or myDisYN ==""' >MYDIS_YN = #{myDisYN}, </if>
			<if test='shopYN != null and shopYN != ""' >SHOP_YN = #{shopYN}, </if>
			<if test='cpnYN != null and cpnYN != ""' >CPN_YN = #{cpnYN}, </if>
			<if test='evtYN != null and evtYN != ""' >EVT_YN = #{evtYN}, </if>
			<if test='newYN != null and newYN != ""' >NEW_YN = #{newYN}, </if>
			<if test='displayYN != null and displayYN != ""' >DISPLAY_YN = #{displayYN}, </if>
			<if test='linkYN != null and linkYN != ""' >LINK_YN = #{linkYN}, </if>
			<if test='cdmaYN != null and cdmaYN != ""' >CDMA_YN = #{cdmaYN}, </if>
			<if test='mType != null and mType != ""' >MTYPE = #{mType}, </if>
			<if test='infoUrl != null and infoUrl != ""' >INFO_URL = #{infoUrl}, </if>
			<if test='smsYN != null and smsYN != ""' >SMS_YN = #{smsYN}, </if>
			<if test='emailYN != null and emailYN != ""' >EMAIL_YN = #{emailYN}, </if>
			<if test='passYN != null and passYN != ""' >PASS_YN = #{passYN}, </if>
			<if test='usimMode != null and usimMode != ""' >USIM_MODE = #{usimMode}, </if>
			<if test='appUrl != null and appUrl != ""' >APP_URL = #{appUrl}, </if>
			<if test='usimId != null and usimId != ""' >USIM_ID = #{usimId}, </if>
			<if test='multiYN != null and multiYN != ""' >MULTI_YN = #{multiYN}, </if>
			<if test='membType != null and membType != ""' >MEMB_TYPE = #{membType}, </if>
			<if test='engNameYN != null and engNameYN != ""' >ENG_NAME_YN = #{engNameYN}, </if>
			<if test='notiUrl and notiUrl != ""' >NOTI_URL = #{notiUrl}, </if>
			<if test='jehyuId != null and jehyuId != ""' >COMP_ID = #{jehyuId}, </if>
			<if test='branId != null and branId != ""' >BRAN_ID = #{branId}, </if>
			<if test='recommYN != null and recommYN != ""' >RECOMM_YN = #{recommYN}, </if>
			<if test='recommSeq != null and recommSeq != ""' >RECOMM_SEQ = #{recommSeq}, </if>
			<if test='popuSeq != null and popuSeq != ""' >POPU_SEQ = #{popuSeq}, </if>
			<if test='pointType != null and pointType != ""' >POINT_TYPE = #{pointType}, </if>
			<if test='barType != null and barType != ""' >BAR_TYPE = #{barType}, </if>
			<if test='classYN != null and classYN != ""' >CLASS_YN = #{classYN}, </if>
			<if test='upperMembId != null and upperMembId != ""' >UPPER_MEMB_ID = #{upperMembId}, </if>
			<if test='shopinfoYN != null and shopinfoYN != ""' >SHOPINFO_YN = #{shopinfoYN}, </if>
			<if test='shopinfoUrl != null and shopinfoUrl != ""' >SHOPINFO_URL = #{shopinfoUrl}, </if>
			
			<if test='membJoinYN != null and membJoinYN != ""' >MEMB_JOIN_YN = #{membJoinYN}, </if>
			<if test='membJoinNMsg != null and membJoinNMsg != ""' >MEMB_JOIN_N_MSG = #{membJoinNMsg}, </if>
			CHG_DAY = REPLACE(CONVERT(VARCHAR(10), GETDATE(), 112), '-', ''),
			CHG_TM = #{chgTm},
			CHG_USER = #{chgUser},
		</trim>
		</set>
		WHERE MEMB_ID = #{membId}
	</update>
	
	<delete id="deleteMember" parameterType="HashMap">
		DELETE
		FROM MEMB_CARDLIST
		WHERE MEMB_ID = #{membId} 
	</delete>
	
	<select id="memberDupCheck" parameterType="java.lang.String" resultType="java.lang.Integer">
		SELECT COUNT(*) AS CNT
		FROM MEMB_CARDLIST
		WHERE MEMB_ID = #{membId}
	</select>
	

	<!-- 멤버십 전시 순서 -->
	<select id="selectMemberOrderList" parameterType="HashMap" resultMap="BaseResultMap" >
		SELECT MEMB_ID
			, NAME
			, ISNULL(MAINDIS_YN,'N') AS MAINDIS_YN
			, ISNULL(MAIN_IDX,0) AS MAIN_IDX
			, ISNULL(RECOMM_YN,'N') AS RECOMM_YN
			, ISNULL(RECOMM_SEQ,4) AS RECOMM_SEQ
		FROM MEMB_CARDLIST
		WHERE STAT = 'R' AND DIS_EDAY &gt;= CONVERT(VARCHAR(8),GETDATE(),112)
		<if test='rSearchType != null and rSearchType == "all"' >
			ORDER BY MAIN_IDX, REG_DAY DESC
		</if>
		<if test='rSearchType != null and rSearchType == "top5"' >
			ORDER BY RECOMM_SEQ, REG_DAY DESC
		</if>
	</select>
	

	<update id="updateMemberOrderListGt" parameterType="HashMap">
		UPDATE MEMB_CARDLIST
		<if test='rSearchType != null and rSearchType == "all"' >
			SET MAIN_IDX = MAIN_IDX - 1
		WHERE MAIN_IDX BETWEEN ${bfVal}+1 AND ${afVal}
		</if>
		<if test='rSearchType != null and rSearchType == "top5"' >
			SET RECOMM_SEQ = RECOMM_SEQ - 1
		WHERE RECOMM_SEQ BETWEEN ${bfVal}+1 AND ${afVal}
		</if>
	</update>

	<update id="updateMemberOrderListLt" parameterType="HashMap">
		UPDATE MEMB_CARDLIST
		<if test='rSearchType != null and rSearchType == "all"' >
			SET MAIN_IDX = MAIN_IDX + 1
		WHERE MAIN_IDX BETWEEN ${afVal} AND ${bfVal}-1
		</if>
		<if test='rSearchType != null and rSearchType == "top5"' >
			SET RECOMM_SEQ = RECOMM_SEQ + 1
		WHERE RECOMM_SEQ BETWEEN ${afVal} AND ${bfVal}-1
		</if>
	</update>
	
	<update id="updateMemberOrder" parameterType="HashMap">
		UPDATE MEMB_CARDLIST 
		<set >
		<trim prefix="" suffix="" suffixOverrides="," >
			<if test='rSearchType != null and rSearchType == "all"' >MAIN_IDX = ${afVal}, MAINDIS_YN = 'Y',</if>
			<if test='rSearchType != null and rSearchType == "top5"' >RECOMM_SEQ = ${afVal}, </if>
		</trim>
		</set>
		WHERE MEMB_ID = #{membId}
	</update>
	
	<update id="updateMemberShowYn" parameterType="HashMap">
		UPDATE MEMB_CARDLIST 
		<set >
		<trim prefix="" suffix="" suffixOverrides="," >
			<if test='rSearchType != null and rSearchType == "all" and chkVal == "Y"' >MAINDIS_YN = 'Y', </if>
			<if test='rSearchType != null and rSearchType == "all" and chkVal == "N"' >MAINDIS_YN = NULL, MAIN_IDX = NULL</if>
			<if test='rSearchType != null and rSearchType == "top5"' >RECOMM_YN = #{chkVal}, </if>
		</trim>
		</set>
		WHERE MEMB_ID = #{membId}
	</update>
	
	<update id="updateMembRecommInitAll" parameterType="HashMap">
		UPDATE MEMB_CARDLIST
		SET RECOMM_YN = CASE WHEN RECOMM_SEQ between 1 and 3 THEN 'Y' ELSE 'N' END
	</update>

	<update id="updateMemberOrderListIncrease" parameterType="HashMap">
		UPDATE MEMB_CARDLIST
		<if test='rSearchType != null and rSearchType == "all"' >
			SET MAIN_IDX = MAIN_IDX + 1
		WHERE MAIN_IDX >= ${afVal}
		</if>
		<if test='rSearchType != null and rSearchType == "top5"' >
			SET RECOMM_SEQ = RECOMM_SEQ + 1
		WHERE RECOMM_SEQ >= ${afVal}
		</if>
	</update>
	
</mapper>