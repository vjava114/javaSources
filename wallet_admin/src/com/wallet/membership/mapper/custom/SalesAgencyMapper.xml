<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.wallet.membership.mapper.custom.SalesAgencyMapper" >
	<resultMap id="BaseResultMap" type="com.wallet.membership.model.custom.SalesAgency" >
	<!--
	WARNING - @mbggenerated
	This element is automatically generated by MyBatis Generator, do not modify.
	This element was generated on Tue Aug 14 13:40:21 KST 2012.
	-->
		<result column="IDX" property="idx" jdbcType="VARCHAR" />
		<result column="COMP_ID" property="compId" jdbcType="VARCHAR" />
		<result column="COMP_NAME" property="compName" jdbcType="VARCHAR" />
		<result column="ALLY_STAT" property="allyStat" jdbcType="VARCHAR" />
		<result column="UPPER_COMP_ID" property="upperCompId" jdbcType="VARCHAR" />
		<result column="COMP_LEVEL_TYPE" property="compLevelType" jdbcType="VARCHAR" />
		<result column="COMP_TYPE" property="compType" jdbcType="VARCHAR" />
		<result column="CPN_RTIME_ISSUE_YN" property="cpnRtimeIssueYn" jdbcType="VARCHAR" />
		<result column="COMPLEX_PAYMENT_YN" property="complexPaymentYn" jdbcType="VARCHAR" />
		<result column="REGION_TYPE" property="regionType" jdbcType="VARCHAR" />
		<result column="ZIPCODE" property="zipcode" jdbcType="VARCHAR" />
		<result column="ADDR" property="addr" jdbcType="VARCHAR" />
		<result column="ADDR_DETAIL" property="addrDetail" jdbcType="VARCHAR" />
		<result column="MAIN_NUMBER" property="mainNumber" jdbcType="VARCHAR" />
		<result column="MANAGER_NAME" property="managerName" jdbcType="VARCHAR" />
		<result column="PHONE_NO" property="phoneNo" jdbcType="VARCHAR" />
		<result column="MOBILE_PHONE" property="mobilePhone" jdbcType="VARCHAR" />
		<result column="EMAIL" property="email" jdbcType="VARCHAR" />
		<result column="LIMIT_AMOUNT_DAY" property="limitAmountDay" jdbcType="VARCHAR" />
		<result column="LIMIT_AMOUNT_WEEK" property="limitAmountWeek" jdbcType="VARCHAR" />
		<result column="LIMIT_AMOUNT_MONTH" property="limitAmountMonth" jdbcType="VARCHAR" />
		<result column="LIMIT_AMOUNT_YEAR" property="limitAmountYear" jdbcType="VARCHAR" />
		<result column="MEMO" property="memo" jdbcType="VARCHAR" />
		<result column="BUSINESS_NO" property="businessNo" jdbcType="VARCHAR" />
		<result column="GPS_X" property="gpsX" jdbcType="VARCHAR" />
		<result column="GPS_Y" property="gpsY" jdbcType="VARCHAR" />
		<result column="SHOP_INFO_URL" property="shopInfoUrl" jdbcType="VARCHAR" />
		<result column="COMP_SHOP_ID" property="compShopId" jdbcType="VARCHAR" />
		<result column="MEMB_ID" property="membId" jdbcType="VARCHAR" />
		<result column="REG_USER" property="regUser" jdbcType="VARCHAR" />
		<result column="REG_DTM" property="regDtm" jdbcType="VARCHAR" />
		<result column="CHG_USER" property="chgUser" jdbcType="VARCHAR" />
		<result column="CHG_DTM" property="chgDtm" jdbcType="VARCHAR" />
	</resultMap>

	<!-- 조회조건에 대한 영업대행사 목록 -->
	<select id="selectSalesAgencyList" parameterType="HashMap" resultMap="BaseResultMap" >
		SELECT *
		FROM (
			SELECT <if test='top!=null and top!=""'> top ${top} </if>
				ROW_NUMBER() OVER(ORDER BY S.REG_DTM DESC) AS IDX 
				, S.COMP_NAME
				, S.COMP_ID
				, S.MANAGER_NAME
				, S.PHONE_NO
				, S.MOBILE_PHONE
				, S.ALLY_STAT
				, CONVERT(VARCHAR(10), S.REG_DTM, 120) as REG_DTM
				, CONVERT(VARCHAR(10), S.CHG_DTM, 120) as CHG_DTM
				, S.COMP_LEVEL_TYPE	
			FROM MW_CM_COMPANY S
			WHERE 1=1
			AND COMP_LEVEL_TYPE='10'
			<if test='sltdsagCompId!=null and sltdsagCompId!=""'>
				AND S.COMP_ID = #{sltdsagCompId}
			</if>
			<if test='ra_searchTerm!=null and ra_searchTerm!="" and ra_searchTerm!="all"'>
				<if test='sdate!=null and sdate!=""'>
					<if test='se_termOpt == "reg_date"'>
						<![CDATA[
							AND CONVERT(VARCHAR(10), S.REG_DTM, 120) >=	#{sdate}
						]]>
					</if>
					<if test='se_termOpt == "chg_date"'>
						<![CDATA[
							AND CONVERT(VARCHAR(10), S.CHG_DTM, 120) >=	#{sdate}
						]]>
					</if>
					
					<if test='edate!=null and edate!=""'>
						<if test='se_termOpt == "reg_date"'>
							<![CDATA[
								AND CONVERT(VARCHAR(10), S.REG_DTM, 120) <=	#{edate}
							]]>
						</if>
						<if test='se_termOpt == "chg_date"'>
							<![CDATA[
								AND CONVERT(VARCHAR(10), S.CHG_DTM, 120) <=	#{edate}
							]]>
						</if>
					</if>
				</if>
			</if>
			<if test='se_termOpt == "chg_date"'>
 				AND S.CHG_DTM IS NOT NULL
 			</if>
			<if test='sagCompName!=null and sagCompName!=""'>
				AND S.COMP_NAME LIKE '%${sagCompName}%'
			</if>
			<if test='ra_allyStat!=null and ra_allyStat!="" and ra_allyStat!="all"'>
				AND S.ALLY_STAT = #{ra_allyStat}
			</if>
			) A
		WHERE 1=1
		<if test='startRow!=null and startRow!=""'>
			<if test='rowsPerPage!=null and rowsPerPage!=""'>
 				AND A.IDX BETWEEN #{startRow, jdbcType=INTEGER} AND #{endRow, jdbcType=INTEGER}
			</if>
		</if>
	</select>
	
	<!-- 조회조건에 대한 영업대행사 총 수 -->
	<select id="selectSalesAgencyListCnt" parameterType="HashMap" resultType="java.lang.Integer">
		SELECT COUNT(*) AS CNT
		FROM MW_CM_COMPANY S
		WHERE 1=1
		AND COMP_LEVEL_TYPE='10'
		<if test='sltdsagCompId!=null and sltdsagCompId!=""'>
			AND S.COMP_ID = #{sltdsagCompId}
		</if>
		<if test='ra_searchTerm!=null and ra_searchTerm!="" and ra_searchTerm!="all"'>
			<if test='sdate!=null and sdate!=""'>
				<if test='se_termOpt == "reg_date"'>
					<![CDATA[
						AND CONVERT(VARCHAR(10), S.REG_DTM, 120) >=	#{sdate}
					]]>
				</if>
				<if test='se_termOpt == "chg_date"'>
					<![CDATA[
						AND CONVERT(VARCHAR(10), S.CHG_DTM, 120) >=	#{sdate}
					]]>
				</if>
				
				<if test='edate!=null and edate!=""'>
					<if test='se_termOpt == "reg_date"'>
						<![CDATA[
							AND CONVERT(VARCHAR(10), S.REG_DTM, 120) <=	#{edate}
						]]>
					</if>
					<if test='se_termOpt == "chg_date"'>
						<![CDATA[
							AND CONVERT(VARCHAR(10), S.CHG_DTM, 120) <=	#{edate}
						]]>
					</if>
				</if>
			</if>
		</if>
		<if test='se_termOpt == "chg_date"'>
 			AND S.CHG_DTM IS NOT NULL
 		</if>
		<if test='sagCompName!=null and sagCompName!=""'>
			AND S.COMP_NAME LIKE '%${sagCompName}%'
		</if>
		<if test='ra_allyStat!=null and ra_allyStat!="" and ra_allyStat!="all"'>
			AND S.ALLY_STAT = #{ra_allyStat}
		</if>
	</select>
	
	<!-- 조회조건에 대한 영업대행사 목록 -->
	<select id="selectSalesAgencyInfo" parameterType="HashMap" resultMap="BaseResultMap" >
		SELECT  S.COMP_NAME
				, S.COMP_ID
				, S.MANAGER_NAME
				, S.PHONE_NO
				, S.MOBILE_PHONE
				, S.ALLY_STAT
				, S.MEMO
				, S.ZIPCODE
				, S.ADDR
				, S.ADDR_DETAIL
				, S.BUSINESS_NO
				, S.MAIN_NUMBER
				, S.EMAIL
				, S.ALLY_STAT
				, S.CHG_USER
				, S.REG_USER
				, CONVERT(VARCHAR(10), S.REG_DTM, 120) as REG_DTM
				, CONVERT(VARCHAR(10), S.CHG_DTM, 120) as CHG_DTM
				, S.COMP_LEVEL_TYPE
				, S.LIMIT_AMOUNT_DAY
				, S.LIMIT_AMOUNT_WEEK
				, S.LIMIT_AMOUNT_MONTH
				, S.LIMIT_AMOUNT_YEAR	
			FROM MW_CM_COMPANY S
			WHERE 1=1
			AND S.COMP_LEVEL_TYPE='10'
			AND S.COMP_ID = #{sltdsagCompId}
	</select>

	<insert id="insertSalesAgency" parameterType="HashMap">
		INSERT INTO MW_CM_COMPANY
		<trim prefix="(" suffix=")" suffixOverrides="," >
				COMP_ID,
			<if test='sagCompName!=null and sagCompName!=""' >COMP_NAME,</if>
			<if test='allyStat!=null and allyStat!=""' >ALLY_STAT,</if>
			<if test='businessNo!=null and businessNo!=""' >BUSINESS_NO,</if>
			<if test='zipcode!=null and zipcode!=""' >ZIPCODE,</if>
			<if test='addr!=null and addr!=""' >ADDR,</if>
			<if test='addrDetail!=null and addrDetail!=""' >ADDR_DETAIL,</if>
			<if test='mainNumber!=null and mainNumber!=""' >MAIN_NUMBER,</if>
			<if test='phoneNo!=null and phoneNo!=""' >PHONE_NO,</if>
			<if test='mobilePhone!=null and mobilePhone!=""' >MOBILE_PHONE,</if>
			<if test='email!=null and email!=""' >EMAIL,</if>
				REG_USER,
				REG_DTM,	
			<if test='limitAmountDay!=null and limitAmountDay!=""' >LIMIT_AMOUNT_DAY,</if>
			<if test='limitAmountWeek!=null and limitAmountWeek!=""' >LIMIT_AMOUNT_Week,</if>
			<if test='limitAmountMonth!=null and limitAmountMonth!=""' >LIMIT_AMOUNT_Month,</if>
			<if test='limitAmountYear!=null and limitAmountYear!=""' >LIMIT_AMOUNT_Year,</if>
			<if test='memo!=null and memo!=""' >MEMO,</if>
			<if test='managerName!=null and managerName!=""' >MANAGER_NAME,</if>
			COMP_LEVEL_TYPE,
		</trim>
		<trim prefix="" suffix="" suffixOverrides="," >
			SELECT 'SAG' + SUBSTRING(REPLICATE('0',9),0,10-LEN(ISNULL(RIGHT(MAX(COMP_ID),9),0)+1)) + LTRIM(STR((ISNULL(RIGHT(MAX(COMP_ID),9),0)+1))) , 
			<if test='sagCompName!=null and sagCompName!=""' >#{sagCompName},</if>
			<if test='allyStat!=null and allyStat!=""' >#{allyStat},</if>
			<if test='businessNo!=null and businessNo!=""' >#{businessNo},</if>
			<if test='zipcode!=null and zipcode!=""' >#{zipcode},</if>
			<if test='addr!=null and addr!=""' >#{addr},</if>
			<if test='addrDetail!=null and addrDetail!=""' >#{addrDetail},</if>
			<if test='mainNumber!=null and mainNumber!=""' >#{mainNumber},</if>
			<if test='phoneNo!=null and phoneNo!=""' >#{phoneNo},</if>
			<if test='mobilePhone!=null and mobilePhone!=""' >#{mobilePhone},</if>
			<if test='email!=null and email!=""' >#{email},</if>
				#{regUser},
				GETDATE(),
			<if test='limitAmountDay!=null and limitAmountDay!=""' >#{limitAmountDay},</if>
			<if test='limitAmountWeek!=null and limitAmountWeek!=""' >#{limitAmountWeek},</if>
			<if test='limitAmountMonth!=null and limitAmountMonth!=""' >#{limitAmountMonth},</if>
			<if test='limitAmountYear!=null and limitAmountYear!=""' >#{limitAmountYear},</if>
			<if test='memo!=null and memo!=""' >#{memo},</if>
			<if test='managerName!=null and managerName!=""' >#{managerName},</if>
				'10',
		</trim>
			FROM MW_CM_COMPANY
			where COMP_ID like 'SAG%'
	</insert>

	<update id="updateSalesAgency" parameterType="HashMap">
		UPDATE MW_CM_COMPANY
		<set>
		<trim prefix="" suffix="" suffixOverrides="," >
			
			<if test='sagCompName!=null and sagCompName!=""' >
				 COMP_NAME = #{sagCompName},
			</if>
			<if test='allyStat!=null and allyStat!=""' >
				 ALLY_STAT = #{allyStat},
			</if>
			<if test='businessNo == null or businessNo == ""' >
				BUSINESS_NO = '',
			</if>
			<if test='businessNo!=null and businessNo!=""' >
				BUSINESS_NO = #{businessNo},
			</if>
			<if test='zipcode!=null and zipcode!=""' >
				ZIPCODE = #{zipcode},
			</if>
			<if test='addr!=null and addr!=""' >
				ADDR = #{addr},
			</if>
			<if test='addrDetail!=null and addrDetail!=""' >
				ADDR_DETAIL = #{addrDetail},
			</if>
			<if test='mainNumber!=null and mainNumber!=""' >
				MAIN_NUMBER = #{mainNumber},
			</if>
			<if test='phoneNo!=null and phoneNo!=""' >
				PHONE_NO = #{phoneNo},
			</if>
			<if test='mobilePhone!=null and mobilePhone!=""' >
				MOBILE_PHONE = #{mobilePhone},
			</if>
			<if test='mobilePhone ==null or mobilePhone ==""' >
				MOBILE_PHONE = '',
			</if>
			<if test='email!=null and email!=""' >
				EMAIL = #{email},
			</if>
			
				CHG_USER = #{chgUser},
				CHG_DTM = GETDATE(),
			<if test='memo!=null and memo!=""' >
				MEMO = #{memo},
			</if>
			<if test='memo == null or memo ==""' >
				MEMO = '',
			</if>
			<if test='managerName!=null and managerName!=""' >
				MANAGER_NAME = #{managerName},
			</if>
			<if test='limitAmountDay!=null and limitAmountDay!=""' >
				LIMIT_AMOUNT_DAY = #{limitAmountDay},
			</if>
			<if test='limitAmountDay==null or limitAmountDay == ""' >
				LIMIT_AMOUNT_DAY = '0',
			</if>
			<if test='limitAmountWeek!=null and limitAmountWeek!=""' >
				LIMIT_AMOUNT_WEEK = #{limitAmountWeek},
			</if>
			<if test='limitAmountWeek==null or limitAmountWeek == ""' >
				LIMIT_AMOUNT_WEEK = '0',
			</if>
			<if test='limitAmountMonth!=null and limitAmountMonth!=""' >
				LIMIT_AMOUNT_MONTH = #{limitAmountMonth},
			</if>
			<if test='limitAmountMonth==null or limitAmountMonth == ""' >
				LIMIT_AMOUNT_MONTH = '0',
			</if>
			<if test='limitAmountYear!=null and limitAmountYear!=""' >
				LIMIT_AMOUNT_YEAR = #{limitAmountYear},
			</if>
			<if test='limitAmountYear==null or limitAmountYear == ""' >
				LIMIT_AMOUNT_YEAR = '0',
			</if>
		</trim>
		</set>
		WHERE COMP_ID = #{sagCompId}
	</update>
	
	<delete id="deleteSalesAgency" parameterType="HashMap">
		DELETE
		FROM MW_CM_COMPANY 
		WHERE COMP_ID = #{sagCompId} 
	</delete>
</mapper>