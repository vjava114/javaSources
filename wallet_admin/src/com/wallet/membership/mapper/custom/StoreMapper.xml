<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.wallet.membership.mapper.custom.StoreMapper" >
	<resultMap id="BaseResultMap" type="com.wallet.membership.model.custom.Store" >
	<!--
	WARNING - @mbggenerated
	This element is automatically generated by MyBatis Generator, do not modify.
	This element was generated on Tue Aug 14 13:40:21 KST 2012.
	-->
		<result column="COMP_ID" property="compId" jdbcType="VARCHAR" />
		<result column="COMP_NAME" property="compName" jdbcType="VARCHAR" />
		<result column="BRAN_ID" property="branId" jdbcType="VARCHAR" />
		<result column="BRAN_NAME" property="branName" jdbcType="VARCHAR" />
		<result column="MEMB_ID" property="membId" jdbcType="VARCHAR" />
		<result column="MEMB_NAME" property="membName" jdbcType="VARCHAR" />
		<result column="STORE_ID" property="storeId" jdbcType="VARCHAR" />
		<result column="STORE_NAME" property="storeName" jdbcType="VARCHAR" />
	</resultMap>

	<!-- 조회조건에 대한 결제사 목록 -->
	<select id="selectStoreList" parameterType="HashMap" resultMap="BaseResultMap" >
		SELECT J.COMP_ID AS COMP_ID
			, J.COMP_NAME AS COMP_NAME
			, B.COMP_ID AS BRAN_ID
			, B.COMP_NAME AS BRAN_NAME
			, S.COMP_ID AS STORE_ID
			, S.COMP_NAME AS STORE_NAME
			, M.MEMB_ID
			, M.NAME AS MEMB_NAME
		FROM MW_CM_COMPANY J, MW_CM_COMPANY B, MW_CM_COMPANY S, memb_cardlist M
		WHERE 1=1
		AND LEFT(J.COMP_ID, 3) = 'CMP'
		AND LEFT(B.COMP_ID, 3) = 'BRD'
		AND LEFT(S.COMP_ID, 3) = 'SHP'
		AND J.COMP_ID = B.UPPER_COMP_ID
		AND B.COMP_ID = S.UPPER_COMP_ID
		AND S.MEMB_ID = M.MEMB_ID
		<if test='compId != null and compId != ""'>
			AND J.COMP_ID = #{compId}
		</if>
		<if test='branId != null and branId != ""'>
			AND B.COMP_ID = #{branId}
		</if>
		<if test='storeName != null and storeName != ""'>
			AND S.COMP_NAME LIKE '%${storeName}%'
		</if>
		AND M.BRAN_ID = (
			CASE WHEN M.BRAN_ID IS NOT NULL THEN B.COMP_ID ELSE NULL END
		)

<!-- 		<if test='membId != null and membId != ""'> -->
<!-- 			AND M.MEMB_ID = #{membId} -->
<!-- 		</if> -->
		ORDER BY J.COMP_ID, B.COMP_ID, M.MEMB_ID, S.COMP_ID
	</select>
</mapper>